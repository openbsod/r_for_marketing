<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta property="og:title" content="Язык R в интернет маркетинге" />
<meta property="og:type" content="book" />


<meta property="og:description" content="Методичесткое пособие к авторскому курсу Алексея Селезнёва “Язык R в интернет маркетинге.”" />
<meta name="github-repo" content="rstudio/bookdown-demo" />

<meta name="author" content="Алексей Селезнёв" />

<meta name="date" content="2018-10-03" />


<meta name="description" content="Методичесткое пособие к авторскому курсу Алексея Селезнёва “Язык R в интернет маркетинге.”">

<title>Язык R в интернет маркетинге</title>

<link href="libs/tufte-css-2015.12.29/tufte-fonts.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte-background.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte-italics.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte.css" rel="stylesheet" />


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



</head>

<body>



<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul>
<li><a href="index.html#section-1"><span class="toc-section-number">1</span> Описание</a></li>
<li class="has-sub"><a href="2-a-.html#a----"><span class="toc-section-number">2</span> a - О курсе</a><ul>
<li><a href="2-1-.html#---"><span class="toc-section-number">2.1</span> Для кого этот курс</a></li>
<li><a href="2-2-.html#-----"><span class="toc-section-number">2.2</span> Какие знания требуются для прохождения курса</a></li>
<li><a href="2-3-.html#-------"><span class="toc-section-number">2.3</span> Какие темы не будут затронуты в ходе курса</a></li>
<li><a href="2-4-.html#------"><span class="toc-section-number">2.4</span> Что вы будете уметь поосле проождения курса</a></li>
<li><a href="2-5-.html#-"><span class="toc-section-number">2.5</span> Поддержка студентов</a></li>
<li><a href="2-5-.html#-"><span class="toc-section-number">2.6</span> Конспект курса</a></li>
<li><a href="2-5-.html#-"><span class="toc-section-number">2.7</span> Программа курса</a></li>
</ul></li>
<li><a href="3-b-.html#b----"><span class="toc-section-number">3</span> b - Об авторе</a></li>
<li><a href="4-c-.html#c---"><span class="toc-section-number">4</span> c - Благодарности</a></li>
<li class="has-sub"><a href="5-1-r-.html#-1---r."><span class="toc-section-number">5</span> Модуль 1: Введение в R.</a><ul>
<li><a href="5-1-r.html#---r"><span class="toc-section-number">5.1</span> История создания языка R</a></li>
<li><a href="5-2-r-.html#--r."><span class="toc-section-number">5.2</span> Преимущества языка R.</a></li>
<li class="has-sub"><a href="5-3-r-rstudio.html#--r----rstudio"><span class="toc-section-number">5.3</span> Установка языка R и среды разработки RStudio</a><ul>
<li><a href="5-3-r-rstudio.html#---r--rstudio"><span class="toc-section-number">5.3.1</span> Ссылки для загрузки R и RStudio</a></li>
</ul></li>
<li class="has-sub"><a href="5-4-power-bi-r-.html#------power-bi---r-."><span class="toc-section-number">5.4</span> Загрузка, преобразование и визуализация данных в Power BI с помощью R скриптов.</a><ul>
<li><a href="5-4-power-bi-r-.html#---power-bi."><span class="toc-section-number">5.4.1</span> Загрузка данных в Power BI.</a></li>
<li><a href="5-4-power-bi-r-.html#---power-bi-power-query."><span class="toc-section-number">5.4.2</span> Преобразование данных в Power BI (power query).</a></li>
<li><a href="5-4-power-bi-r-.html#---power-bi------r."><span class="toc-section-number">5.4.3</span> Визуализация данных в Power BI с помощью визуального элемента скрипта R.</a></li>
<li><a href="5-4-power-bi-r-.html#---power-bi--r-."><span class="toc-section-number">5.4.4</span> Использование пользовательских параметров Power BI в R скриптах.</a></li>
</ul></li>
<li><a href="5-5-rstudio.html#--rstudio"><span class="toc-section-number">5.5</span> Среда разработки RStudio</a></li>
<li class="has-sub"><a href="5-6-r.html#----r"><span class="toc-section-number">5.6</span> Классы объектов в языке R</a><ul>
<li><a href="5-6-r.html#section-5.6.1"><span class="toc-section-number">5.6.1</span> Векторы</a></li>
<li><a href="5-6-r.html#-data.frame"><span class="toc-section-number">5.6.2</span> Таблицы (data.frame)</a></li>
<li><a href="5-6-r.html#-list"><span class="toc-section-number">5.6.3</span> Списки (list)</a></li>
<li><a href="5-6-r.html#--"><span class="toc-section-number">5.6.4</span> Проверить класс объекта</a></li>
</ul></li>
<li class="has-sub"><a href="5-7-r.html#-----r"><span class="toc-section-number">5.7</span> Работа со строками на языке R</a><ul>
<li><a href="5-7-r.html#-------r"><span class="toc-section-number">5.7.1</span> Базовые возможности для работы со строками в R</a></li>
<li><a href="5-7-r.html#------stringr"><span class="toc-section-number">5.7.2</span> Работа со строками с помощью пакета stringr</a></li>
</ul></li>
<li class="has-sub"><a href="5-8-csv-excel-json-r.html#---csv-excel--json---r"><span class="toc-section-number">5.8</span> Загрузка данных из csv, excel и json файлов в R</a><ul>
<li><a href="5-8-csv-excel-json-r.html#---csv-"><span class="toc-section-number">5.8.1</span> Загрузка данных из csv файлов</a></li>
<li><a href="5-8-csv-excel-json-r.html#---excel-"><span class="toc-section-number">5.8.2</span> Загрузка данных из Excel файлов</a></li>
<li><a href="5-8-csv-excel-json-r.html#---json-"><span class="toc-section-number">5.8.3</span> Загрузка данных из JSON файлов</a></li>
</ul></li>
<li><a href="5-9-r.html#------r"><span class="toc-section-number">5.9</span> Агрегирующие функции и арифметические операции в R</a></li>
<li class="has-sub"><a href="5-10-.html#-----."><span class="toc-section-number">5.10</span> Манипуляция с данными, (группировка и агреция).</a><ul>
<li><a href="5-10-.html#-dplyr"><span class="toc-section-number">5.10.1</span> Пакет dplyr</a></li>
<li><a href="5-10-.html#-data.table"><span class="toc-section-number">5.10.2</span> Пакет data.table</a></li>
<li><a href="5-10-.html#-sqldf"><span class="toc-section-number">5.10.3</span> Пакет sqldf</a></li>
<li><a href="5-10-.html#-tidyr"><span class="toc-section-number">5.10.4</span> Пакет tidyr</a></li>
</ul></li>
<li class="has-sub"><a href="5-11-r-lubridate-.html#------r--lubridate."><span class="toc-section-number">5.11</span> Работа с датами и временем в R, пакет lubridate.</a><ul>
<li><a href="5-11-r-lubridate-.html#---------r"><span class="toc-section-number">5.11.1</span> Базовые возможности по работе с датой и временем в R</a></li>
<li><a href="5-11-r-lubridate-.html#-lubridate"><span class="toc-section-number">5.11.2</span> Пакет lubridate</a></li>
</ul></li>
<li><a href="5-12-if-ifelse-switch-r.html#--if-ifelse-switch--r"><span class="toc-section-number">5.12</span> Условные конструкции if, ifelse, switch в R</a></li>
<li class="has-sub"><a href="5-13-for-while.html#-for--while"><span class="toc-section-number">5.13</span> Циклы for и while</a><ul>
<li><a href="5-13-for-while.html#-for"><span class="toc-section-number">5.13.1</span> Цикл for</a></li>
<li><a href="5-13-for-while.html#-while"><span class="toc-section-number">5.13.2</span> Цикл while</a></li>
</ul></li>
<li><a href="5-7-r.html#-----r"><span class="toc-section-number">5.14</span> Разработка собственных функций в языке R</a></li>
<li><a href="5-15-r-try.html#---r--try"><span class="toc-section-number">5.15</span> Обработка ошибок в R, функция try</a></li>
<li><a href="2-1-.html#---"><span class="toc-section-number">5.16</span> Рекомендации по оформлению кода</a></li>
</ul></li>
<li class="has-sub"><a href="6-2-api-.html#-2---api--."><span class="toc-section-number">6</span> Модуль 2: Работа с API рекламных площадок.</a><ul>
<li class="has-sub"><a href="6-1-api.html#--api"><span class="toc-section-number">6.1</span> Что такое API</a><ul>
<li><a href="6-1-api.html#-http-"><span class="toc-section-number">6.1.1</span> Типы HTTP запросов</a></li>
</ul></li>
<li class="has-sub"><a href="6-2-api-google-ads.html#--api-google-ads"><span class="toc-section-number">6.2</span> Работа с API Google Ads</a><ul>
<li><a href="6-2-api-google-ads.html#----api-google-ads"><span class="toc-section-number">6.2.1</span> Как получить доступ к API Google Ads</a></li>
<li><a href="6-2-api-google-ads.html#--api-google-ads"><span class="toc-section-number">6.2.2</span> Как устроен API Google Ads</a></li>
<li><a href="6-2-api-google-ads.html#-radwords"><span class="toc-section-number">6.2.3</span> Пакет RAdwords</a></li>
</ul></li>
<li class="has-sub"><a href="6-3-api-.html#--api--"><span class="toc-section-number">6.3</span> Работа с API Яндекс Директ</a><ul>
<li><a href="6-3-api-.html#-ryandexdirect"><span class="toc-section-number">6.3.1</span> Пакет ryandexdirect</a></li>
</ul></li>
<li class="has-sub"><a href="6-4-api-facebook.html#--api-facebook"><span class="toc-section-number">6.4</span> Работа с API Facebook</a><ul>
<li><a href="6-4-api-facebook.html#---facebook"><span class="toc-section-number">6.4.1</span> Создание приложения в Facebook</a></li>
<li><a href="6-4-api-facebook.html#--api-facebook"><span class="toc-section-number">6.4.2</span> Авторизация в API Facebook</a></li>
<li><a href="6-4-api-facebook.html#-----facebook"><span class="toc-section-number">6.4.3</span> Загрузка объектов из рекламного кабинета Facebook</a></li>
</ul></li>
<li class="has-sub"><a href="6-5-api-vk-com.html#--api--vk.com"><span class="toc-section-number">6.5</span> Работа с API Вконтакте (vk.com)</a><ul>
<li><a href="6-5-api-vk-com.html#-----api-"><span class="toc-section-number">6.5.1</span> Создание приложения для работы с API Вконтакте</a></li>
<li><a href="6-5-api-vk-com.html#--api-"><span class="toc-section-number">6.5.2</span> Авторизация в API Вконтакте</a></li>
<li><a href="6-5-api-vk-com.html#--rvkstat"><span class="toc-section-number">6.5.3</span> Функции пакета rvkstat</a></li>
<li><a href="2-2-.html#-----"><span class="toc-section-number">6.5.4</span> Загрузка объектов из рекламного кабинета Вконтакте</a></li>
<li><a href="2-2-.html#-----"><span class="toc-section-number">6.5.5</span> Загрузка статистики из рекламного кабинета Вконтакте</a></li>
<li><a href="2-4-.html#------"><span class="toc-section-number">6.5.6</span> Загрузка статистики по сообществам и группам Вконтакте</a></li>
</ul></li>
<li class="has-sub"><a href="6-6-api-mytarget.html#--api-mytarget"><span class="toc-section-number">6.6</span> Работа с API MyTarget</a><ul>
<li><a href="6-6-api-mytarget.html#--api-mytarget"><span class="toc-section-number">6.6.1</span> Авторизация в API MyTarget</a></li>
</ul></li>
<li class="has-sub"><a href="6-7-google-analytics.html#---google-analytics"><span class="toc-section-number">6.7</span> Загрузка данных из Google Analytics</a><ul>
<li><a href="6-7-google-analytics.html#-api----google-analytics"><span class="toc-section-number">6.7.1</span> Какие API интерфейсы доступны в Google Analytics</a></li>
<li><a href="6-7-google-analytics.html#--api-google-analytics"><span class="toc-section-number">6.7.2</span> Авторизация в API Google Analytics</a></li>
<li><a href="6-7-google-analytics.html#--management-api"><span class="toc-section-number">6.7.3</span> Работа с Management API</a></li>
<li><a href="6-7-google-analytics.html#--core-reporting-api"><span class="toc-section-number">6.7.4</span> Работа с Core Reporting API</a></li>
<li><a href="6-7-google-analytics.html#--multi-channel-funnels-api"><span class="toc-section-number">6.7.5</span> Работа с Multi-Channel Funnels API</a></li>
<li><a href="6-7-google-analytics.html#--real-time-reporting-api"><span class="toc-section-number">6.7.6</span> Работа с Real time reporting API</a></li>
</ul></li>
<li class="has-sub"><a href="6-3-api-.html#---api--"><span class="toc-section-number">6.8</span> Загрузка данных из API Яндекс Метрики</a><ul>
<li><a href="6-3-api-.html#----api--"><span class="toc-section-number">6.8.1</span> Авторизация для работы с API Яндекс Метрики</a></li>
<li><a href="6-8-api-.html#----api---"><span class="toc-section-number">6.8.2</span> Функции для работы с API управления Яндекс Метрики</a></li>
<li><a href="6-8-api-.html#---api---"><span class="toc-section-number">6.8.3</span> Загрузка данных из API отчётов Яндекс Метрики</a></li>
<li><a href="6-8-api-.html#---logs-api--"><span class="toc-section-number">6.8.4</span> Загрузка данных из Logs API Яндекс Метрики</a></li>
<li><a href="6-8-api-.html#---api-----core-reporting-api-google-analytics"><span class="toc-section-number">6.8.5</span> Загрузка данных из API Яндекс Метрики совместимого с Core Reporting API Google Analytics</a></li>
</ul></li>
<li class="has-sub"><a href="6-9-google-search-console.html#--google-search-console"><span class="toc-section-number">6.9</span> Работа с Google Search Console</a><ul>
<li><a href="6-9-google-search-console.html#----5000---1-"><span class="toc-section-number">6.9.1</span> Как обойти ограничение в 5000 строк на 1 запрос</a></li>
</ul></li>
<li class="has-sub"><a href="6-10-google-trends.html#--google-trends"><span class="toc-section-number">6.10</span> Работа с Google Trends</a><ul>
<li><a href="6-10-google-trends.html#-----google-trends"><span class="toc-section-number">6.10.1</span> Манипуляция с данными полученными из Google Trends</a></li>
</ul></li>
<li class="has-sub"><a href="5-6-r.html#--"><span class="toc-section-number">6.11</span> Парсинг веб сайтов</a><ul>
<li><a href="5-6-r.html#----"><span class="toc-section-number">6.11.1</span> Поиск элементов на веб странице</a></li>
<li><a href="6-11-.html#-----html-"><span class="toc-section-number">6.11.2</span> Извлечение значений из полученныз элементов HTML страницы</a></li>
<li><a href="2-1-.html#---"><span class="toc-section-number">6.11.3</span> Имитация пользовательской веб сессии</a></li>
</ul></li>
<li><a href="6-1-api.html#-http-"><span class="toc-section-number">6.12</span> отправка HTTP запросов</a></li>
</ul></li>
<li class="has-sub"><a href="7-3-api-.html#-3-----api----."><span class="toc-section-number">7</span> Модуль 3: Работа с загруженными из API интерфейсов различных сервисов данными.</a><ul>
<li><a href="7-1-google-.html#-----google-"><span class="toc-section-number">7.1</span> Отправка и стение данных из Google Таблиц</a></li>
<li class="has-sub"><a href="7-2-ggplot2.html#-----ggplot2"><span class="toc-section-number">7.2</span> Визуализация данных с помощью пакета ggplot2</a><ul>
<li><a href="7-2-ggplot2.html#---qplot"><span class="toc-section-number">7.2.1</span> Быстрый график, функция <code>qplot</code></a></li>
<li><a href="2-1-.html#---"><span class="toc-section-number">7.2.2</span> Построение графиков наложением слоёв</a></li>
</ul></li>
<li class="has-sub"><a href="7-3-dbi-.html#----dbi-------"><span class="toc-section-number">7.3</span> Работа с базами данных, DBI - Интерфейс взаимодействия с базами данных</a><ul>
<li><a href="7-3-dbi-.html#---mysql"><span class="toc-section-number">7.3.1</span> Работа с СУБД MySQL</a></li>
<li><a href="7-3-dbi-.html#----postgresql"><span class="toc-section-number">7.3.2</span> Работа с базой данных PostgreSQL</a></li>
<li><a href="7-3-dbi-.html#----sqlite"><span class="toc-section-number">7.3.3</span> Работа с базой данных SQLite</a></li>
<li><a href="7-3-dbi-.html#-----google-bigquery"><span class="toc-section-number">7.3.4</span> Работа с облачной базой данных Google BigQuery</a></li>
</ul></li>
<li><a href="5-6-r.html#----r"><span class="toc-section-number">7.4</span> Отправка почты с помощью R</a></li>
<li class="has-sub"><a href="7-5-r-.html#---r---"><span class="toc-section-number">7.5</span> Как настроить запуск R скриптов по рассписанию</a><ul>
<li><a href="2-1-.html#---"><span class="toc-section-number">7.5.1</span> Настройка расписание через плагин</a></li>
<li><a href="7-5-r-.html#------taskscheduler"><span class="toc-section-number">7.5.2</span> Настройка расписание с помощью функций пакета taskscheduleR</a></li>
<li><a href="7-5-r-.html#------windows"><span class="toc-section-number">7.5.3</span> Ручная настройка рассписания через планировщик задач Windows</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="8-r-r-sources.html#-----r-r-sources"><span class="toc-section-number">8</span> Полезные, русскоязычные ресурсы по языку R (r sources)</a><ul>
<li><a href="2-1-.html#---"><span class="toc-section-number">8.1</span> Группы в социальных сетях</a></li>
<li><a href="2-1-.html#---"><span class="toc-section-number">8.2</span> Телеграмм каналы и чаты</a></li>
<li><a href="8-3-section-8-3.html#section-8.3"><span class="toc-section-number">8.3</span> Блоги</a></li>
</ul></li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="----dbi-------" class="section level2">
<h2><span class="header-section-number">7.3</span> Работа с базами данных, DBI - Интерфейс взаимодействия с базами данных</h2>
<p>DBI - это интерфейс взаимодействия с базами данных.</p>
<p><strong>Основные функции для работы с базами данных</strong></p>
<ul>
<li><code>dbConnect</code> - Подключение к базе данных</li>
<li><code>dbWriteTable</code> - Запись таблицы в базу данных</li>
<li><code>dbReadTable</code> - Загрузка таблицы из базы данных</li>
<li><code>dbGetQuery</code> - Получить результат выполнения запроса</li>
<li><code>dbSendQuery</code> - Отправка запроса к базе данных</li>
<li><code>dbFetch</code> - Извлечени еэлементов из набора результатов</li>
<li><code>dbGetInfo</code> - Получить информацию о результате запроса или подключении</li>
<li><code>dbListFields</code> - Получить список полей таблицы</li>
<li><code>dbListTables</code> - Список таблиц базы данных</li>
<li><code>dbExistsTable</code> - Проверка наличия таблицы в базе данны</li>
<li><code>dbRemoveTable</code> - Удаление таблицы из базы данных</li>
<li><code>dbDisconnect</code> - Отсоединение от базы данных</li>
</ul>
<div id="---mysql" class="section level3">
<h3><span class="header-section-number">7.3.1</span> Работа с СУБД MySQL</h3>
<p><a href="https://ru.wikipedia.org/wiki/MySQL">MySQL</a> - это одна из наиболее популярных, бесплатных, клиент-серверных баз данных.</p>
<p>Для работы с какой либо базой данных помимо пакета <code>DBI</code> необходимо установить дополнительный пакет, который является драйвером и интерфейсом для работы с какой либо конкретной базой данных, для работы с MySQL моожно установить либо <code>RMySQL</code> либо его более актуальную интерпритацию <code>RMariaDB</code>.</p>
<p>Жанные пакеты можно устанавливать из CRAN: <code>install.packages(&quot;RMariaDB&quot;)</code></p>
<p>Следующий скрипт демонстрирует использование всех перечисленных выше функций, в нём мы изначально подключимся к базе данных MySQL, поле чего загрузим некоторые данные из API Facebook, и отправим эи данные в базу данных, после чего продемонстрируем как обратно считать записанные рание данные, и то как работать с другими функциями DBI интерфейса.</p>
<p><strong>Пример</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(RMariaDB)
<span class="kw">library</span>(rfacebookstat)

<span class="co"># Подключаемя к базе данных</span>
con &lt;-<span class="st"> </span><span class="kw">dbConnect</span>(<span class="dt">drv =</span> <span class="kw">MariaDB</span>(),
                 <span class="dt">user =</span> <span class="st">&quot;имя пользователя&quot;</span>,
                 <span class="dt">password =</span> <span class="st">&quot;пароль&quot;</span>,
                 <span class="dt">host     =</span> <span class="st">&quot;localhost&quot;</span>,
                 <span class="dt">port     =</span> <span class="st">&quot;3306&quot;</span>,
                 <span class="dt">dbname   =</span> <span class="st">&quot;название базы данных&quot;</span>)

<span class="co"># Загрузка данных из facebook</span>
<span class="co"># более подробно о том как работать с API Facebook написано во второй части</span>
<span class="kw">load</span>(<span class="st">&quot;C:</span><span class="ch">\\</span><span class="st">r_for_marketing_course</span><span class="ch">\\</span><span class="st">Материалы курса</span><span class="ch">\\</span><span class="st">Модуль 2</span><span class="ch">\\</span><span class="st">Урок 4</span><span class="ch">\\</span><span class="st">fb_token.RData&quot;</span>)

my_fb_stats &lt;-<span class="st"> </span><span class="kw">fbGetMarketingStat</span>(<span class="dt">accounts_id =</span> <span class="st">&quot;act_111111111&quot;</span>,
                                  <span class="dt">level =</span> <span class="st">&quot;ad&quot;</span>,
                                  <span class="dt">fields =</span> <span class="st">&quot;account_name,campaign_name,ad_id,impressions,clicks&quot;</span>,
                                  <span class="dt">breakdowns =</span> <span class="st">&quot;impression_device&quot;</span>,
                                  <span class="dt">date_start =</span> <span class="kw">Sys.Date</span>() <span class="op">-</span><span class="st"> </span><span class="dv">20</span>,
                                  <span class="dt">date_stop =</span> <span class="kw">Sys.Date</span>() <span class="op">-</span><span class="st"> </span><span class="dv">11</span>,
                                  <span class="dt">interval =</span> <span class="st">&quot;day&quot;</span>,
                                  <span class="dt">access_token =</span> fb_token)


<span class="co"># Запись данных в MySQL</span>
<span class="kw">dbWriteTable</span>(<span class="dt">conn      =</span> con,
             <span class="dt">value     =</span> my_fb_stats,
             <span class="dt">name      =</span> <span class="st">&quot;fb_data&quot;</span>,
             <span class="dt">append    =</span> <span class="ot">TRUE</span>,
             <span class="dt">overwrite =</span> <span class="ot">FALSE</span>,
             <span class="dt">row.names =</span> <span class="ot">FALSE</span>)

<span class="co"># Загрузка таблицы из базы данных</span>
mysql_table &lt;-<span class="st"> </span><span class="kw">dbReadTable</span>(<span class="dt">conn =</span> con, <span class="dt">name =</span> <span class="st">&quot;fb_data&quot;</span>)

<span class="co"># Загрузка результата выполнения запроса</span>
query_table &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(<span class="dt">conn =</span> con,
                          <span class="dt">statement =</span> <span class="st">&quot;SELECT impression_device, SUM(clicks) as clicks</span>
<span class="st">                                       FROM fb_data</span>
<span class="st">                                       GROUP BY impression_device&quot;</span>)

query_table_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">dbSendQuery</span>(<span class="dt">conn =</span> con,
                             <span class="dt">statement =</span> <span class="st">&quot;SELECT impression_device, SUM(clicks) as clicks</span>
<span class="st">                             FROM fb_data</span>
<span class="st">                             GROUP BY impression_device&quot;</span>)

<span class="kw">class</span>(query_table_<span class="dv">2</span>)
<span class="kw">dbGetInfo</span>(query_table_<span class="dv">2</span>) <span class="co"># query info</span>
query_table_2_data &lt;-<span class="st"> </span><span class="kw">dbFetch</span>(<span class="dt">res =</span> query_table_<span class="dv">2</span>, <span class="dt">n =</span> <span class="op">-</span><span class="dv">1</span>) <span class="co"># get data</span>
<span class="kw">dbGetInfo</span>(query_table_<span class="dv">2</span>) <span class="co"># query info</span>
<span class="kw">dbClearResult</span>(query_table_<span class="dv">2</span>)  <span class="co"># cleare</span>
<span class="kw">dbGetInfo</span>(query_table_<span class="dv">2</span>) <span class="co"># query info</span>

<span class="co"># Загрузка списка полей из таблицы</span>
<span class="kw">dbListFields</span>(<span class="dt">conn =</span> con, <span class="st">&quot;fb_data&quot;</span>)

<span class="co"># Загрузка списка таблициз базы данных</span>
<span class="kw">dbListTables</span>(con)

<span class="co"># Проверка наличия таблицы в базе данных</span>
<span class="kw">dbExistsTable</span>(<span class="dt">conn =</span> con, <span class="st">&quot;fb_data&quot;</span>)

<span class="co"># Удаление таблицы</span>
<span class="kw">dbRemoveTable</span>(<span class="dt">conn =</span> con, <span class="st">&quot;fb_data&quot;</span>)

<span class="co"># Проверка наличия таблицы в базе данных</span>
<span class="kw">dbListTables</span>(con)

<span class="co"># Отключение от базы данных</span>
<span class="kw">dbDisconnect</span>(con)</code></pre></div>
<p>Функция <code>dbConnect</code> создаёт объект подключения к базе данных, в случае работы с клиент серверными базами данных для подключения вам необходимо будет использовать следующие аргумены:</p>
<ul>
<li>drv - Функция которая является драйвером для работы с базой данных, если мы говорим о пакете <code>RMariaDB</code> то необходимо указать <code>MariaDB()</code>, если вы используете пакет <code>RMySQL</code> то необходимо указать <code>MySQL()</code>.</li>
<li>user = Имя пользователя базы данных</li>
<li>password = Пароль для подключения к базе данных</li>
<li>host = IP адрес сервера базы данных</li>
<li>port = Порт, для MySQL стандартным портом является 3306</li>
<li>dbname = Название базы данных к которой вы будете подключаться</li>
</ul>
<p>Далее полученный с помощью функции <code>dbConnect</code> объект вы будете использовать во всех остальных функции для работы с базой данных.</p>
<p>Для записи информации в базу данных необходимо использовать <code>dbWriteTable</code>, указав следующие аргументы.</p>
<ul>
<li>conn - Объект подключения</li>
<li>value - Данные которые вы хотите записать, как правило это какой либо датафрейм</li>
<li>name - Название таблицы в которую будут записаны данные</li>
<li>append - Дописывать ли строки если такая таблица уже существует в базе данных</li>
<li>overwrite = Перезаписать данные если такая таблица уже существует в базе данных</li>
<li>row.names = Записывать ли в базу данных имена строк</li>
</ul>
<p>Все остальные функции пакета имеют интуитивно понятный набор аргументов.</p>
</div>
<div id="----postgresql" class="section level3">
<h3><span class="header-section-number">7.3.2</span> Работа с базой данных PostgreSQL</h3>
<p><a href="https://ru.wikipedia.org/wiki/PostgreSQL">PostgreSQL</a> - Свободная объектно-реляционная система управления базами данных.</p>
<p>Для работы с PostgreSQL вам необходимо установить пакет <code>RPostgreSQL</code> - <code>install.packages(&quot;RPostgreSQL&quot;)</code></p>
<p>Никакой разницы между работой с PostgreSQL через DBI нет, вы будете использовать теже функции как и в примере выше при работе с MySQL, единственное отличие это то, что вам при подключении используя функцию <code>dbConnect</code>, в аргумент <em>drv</em> необходимо передать функцию <code>PostgreSQL()</code>.</p>
<p><strong>Пример работы с PostgreSQL</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(RPostgreSQL)
<span class="kw">library</span>(rfacebookstat)

<span class="co"># connect</span>
con &lt;-<span class="st"> </span><span class="kw">dbConnect</span>(<span class="dt">drv =</span> <span class="kw">PostgreSQL</span>(),
                 <span class="dt">user =</span> <span class="st">&quot;имя пользоватея БД&quot;</span>,
                 <span class="dt">password =</span> <span class="st">&quot;пароль&quot;</span>,
                 <span class="dt">host     =</span> <span class="st">&quot;IP сервера&quot;</span>,
                 <span class="dt">port     =</span> <span class="st">&quot;5432&quot;</span>,
                 <span class="dt">dbname   =</span> <span class="st">&quot;название базы данных&quot;</span>)

<span class="co"># check connection</span>
<span class="kw">dbGetInfo</span>(con)

<span class="co"># load data</span>
<span class="co"># fb load</span>
<span class="kw">load</span>(<span class="st">&quot;C:</span><span class="ch">\\</span><span class="st">r_for_marketing_course</span><span class="ch">\\</span><span class="st">Материалы курса</span><span class="ch">\\</span><span class="st">Модуль 2</span><span class="ch">\\</span><span class="st">Урок 4</span><span class="ch">\\</span><span class="st">fb_token.RData&quot;</span>)

my_fb_stats &lt;-<span class="st"> </span><span class="kw">fbGetMarketingStat</span>(<span class="dt">accounts_id =</span> <span class="st">&quot;act_11111111111&quot;</span>,
                                  <span class="dt">level =</span> <span class="st">&quot;ad&quot;</span>,
                                  <span class="dt">fields =</span> <span class="st">&quot;campaign_name,ad_id,impressions,clicks&quot;</span>,
                                  <span class="dt">breakdowns =</span> <span class="st">&quot;impression_device&quot;</span>,
                                  <span class="dt">date_start =</span> <span class="kw">Sys.Date</span>() <span class="op">-</span><span class="st"> </span><span class="dv">20</span>,
                                  <span class="dt">date_stop =</span> <span class="kw">Sys.Date</span>() <span class="op">-</span><span class="st"> </span><span class="dv">1</span>,
                                  <span class="dt">interval =</span> <span class="st">&quot;day&quot;</span>,
                                  <span class="dt">access_token =</span> fb_token)
<span class="co"># send to mysql</span>
<span class="kw">dbWriteTable</span>(<span class="dt">conn        =</span> con,
             <span class="dt">value       =</span> my_fb_stats,
             <span class="dt">name        =</span> <span class="st">&quot;fb_data&quot;</span>,
             <span class="dt">append      =</span> <span class="ot">TRUE</span>,
             <span class="dt">overwrite   =</span> <span class="ot">FALSE</span>,
             <span class="dt">row.names   =</span> <span class="ot">FALSE</span>,
             <span class="dt">field.types =</span> <span class="kw">c</span>(<span class="dt">campaign_name     =</span> <span class="st">&quot;character(300)&quot;</span>,
                             <span class="dt">ad_id             =</span> <span class="st">&quot;bigint&quot;</span>,
                             <span class="dt">impressions       =</span> <span class="st">&quot;integer&quot;</span>,
                             <span class="dt">clicks            =</span> <span class="st">&quot;integer&quot;</span>,
                             <span class="dt">date_start        =</span> <span class="st">&quot;date&quot;</span>,
                             <span class="dt">date_stop         =</span> <span class="st">&quot;date&quot;</span>,
                             <span class="dt">impression_device =</span> <span class="st">&quot;character(100)&quot;</span>))

<span class="co"># load data from mysql</span>
pgsql_table &lt;-<span class="st"> </span><span class="kw">dbReadTable</span>(<span class="dt">conn =</span> con, <span class="dt">name =</span> <span class="st">&quot;fb_data&quot;</span>)

<span class="co"># load by sql query</span>
query_pgsql &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(<span class="dt">conn =</span> con,
                          <span class="dt">statement =</span> <span class="st">&quot;SELECT impression_device, SUM(clicks) as clicks</span>
<span class="st">                                       FROM fb_data</span>
<span class="st">                                       GROUP BY impression_device&quot;</span>)

<span class="co"># fields of table</span>
<span class="kw">dbListFields</span>(<span class="dt">conn =</span> con, <span class="st">&quot;fb_data&quot;</span>)

<span class="co"># search table</span>
<span class="kw">dbListTables</span>(con)
<span class="kw">dbExistsTable</span>(<span class="dt">conn =</span> con, <span class="st">&quot;fb_data&quot;</span>)

<span class="co"># drop table</span>
<span class="kw">dbRemoveTable</span>(<span class="dt">conn =</span> con, <span class="st">&quot;fb_data&quot;</span>)

<span class="co"># check</span>
<span class="kw">dbListTables</span>(con)

<span class="co"># disconnect</span>
<span class="kw">dbDisconnect</span>(con)</code></pre></div>
</div>
<div id="----sqlite" class="section level3">
<h3><span class="header-section-number">7.3.3</span> Работа с базой данных SQLite</h3>
<p><a href="http://wikipedia.green/SQLite">SQLite</a> — компактная встраиваемая СУБД. Исходный код библиотеки передан в общественное достояние. В 2005 году проект получил награду Google-O’Reilly Open Source Awards.</p>
<p>SQLite достаточно удобна для локального хранения данных, база не требует установки, и легко может быть интегрирована в ваши скрипты.</p>
<p>Работа с SQLite через DBI интерфейс практически не отличается от рассмотренных ранее примеров с MySQL и PostgreSQL, в данном случае мы будем использовать пакет <code>RSQLite</code> и при использовании функции <code>dbConnect</code> для подключения к SQLite вам достаочно всего лишь указать в аргумент <em>drv</em> функцию <code>SQLite()</code> и в качестве второго аргемента указать название базы данных которую вы будете использовать, база даннх является локальным файлом с расширением <em>.db</em>, если указанная база данных не была найдена в рабочей директории она будет создана автоматически.</p>
<p><strong>Пример кода для работы с SQLite</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># go to wd</span>
<span class="kw">setwd</span>(<span class="st">&quot;C:</span><span class="ch">\\</span><span class="st">r_for_marketing_course</span><span class="ch">\\</span><span class="st">Материалы курса</span><span class="ch">\\</span><span class="st">Модуль 3</span><span class="ch">\\</span><span class="st">Урок 3&quot;</span>)

<span class="co"># connection or create base</span>
con &lt;-<span class="st"> </span><span class="kw">dbConnect</span>(<span class="dt">drv =</span> <span class="kw">SQLite</span>(),
                 <span class="st">&quot;r_cource_test_base.db&quot;</span>)

<span class="co"># fb load</span>
<span class="kw">load</span>(<span class="st">&quot;C:</span><span class="ch">\\</span><span class="st">r_for_marketing_course</span><span class="ch">\\</span><span class="st">Материалы курса</span><span class="ch">\\</span><span class="st">Модуль 2</span><span class="ch">\\</span><span class="st">Урок 4</span><span class="ch">\\</span><span class="st">fb_token.RData&quot;</span>)

my_fb_stats &lt;-<span class="st"> </span><span class="kw">fbGetMarketingStat</span>(<span class="dt">accounts_id =</span> <span class="st">&quot;act_262115113&quot;</span>,
                                  <span class="dt">level =</span> <span class="st">&quot;ad&quot;</span>,
                                  <span class="dt">fields =</span> <span class="st">&quot;campaign_name,ad_id,impressions,clicks&quot;</span>,
                                  <span class="dt">breakdowns =</span> <span class="st">&quot;impression_device&quot;</span>,
                                  <span class="dt">date_start =</span> <span class="kw">Sys.Date</span>() <span class="op">-</span><span class="st"> </span><span class="dv">20</span>,
                                  <span class="dt">date_stop =</span> <span class="kw">Sys.Date</span>() <span class="op">-</span><span class="st"> </span><span class="dv">11</span>,
                                  <span class="dt">interval =</span> <span class="st">&quot;day&quot;</span>,
                                  <span class="dt">access_token =</span> fb_token)


<span class="co"># send to mysql</span>
<span class="kw">dbWriteTable</span>(<span class="dt">conn      =</span> con,
             <span class="dt">value     =</span> my_fb_stats,
             <span class="dt">name      =</span> <span class="st">&quot;fb_data&quot;</span>,
             <span class="dt">append    =</span> <span class="ot">FALSE</span>,
             <span class="dt">overwrite =</span> <span class="ot">FALSE</span>,
             <span class="dt">row.names =</span> <span class="ot">FALSE</span>,
             <span class="dt">field.types =</span> <span class="kw">c</span>(<span class="dt">campaign_name     =</span> <span class="st">&quot;character(300)&quot;</span>,
                             <span class="dt">ad_id             =</span> <span class="st">&quot;bigint&quot;</span>,
                             <span class="dt">impressions       =</span> <span class="st">&quot;integer&quot;</span>,
                             <span class="dt">clicks            =</span> <span class="st">&quot;integer&quot;</span>,
                             <span class="dt">date_start        =</span> <span class="st">&quot;date&quot;</span>,
                             <span class="dt">date_stop         =</span> <span class="st">&quot;date&quot;</span>,
                             <span class="dt">impression_device =</span> <span class="st">&quot;character(100)&quot;</span>))

<span class="co"># load data from mysql</span>
sqlite_table &lt;-<span class="st"> </span><span class="kw">dbReadTable</span>(<span class="dt">conn =</span> con, <span class="dt">name =</span> <span class="st">&quot;fb_data&quot;</span>)

<span class="co"># load by sql query</span>
query_sqlite &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(<span class="dt">conn =</span> con,
                           <span class="dt">statement =</span> <span class="st">&quot;SELECT impression_device, SUM(clicks) as clicks</span>
<span class="st">                                         FROM fb_data</span>
<span class="st">                                         GROUP BY impression_device&quot;</span>)

<span class="co"># fields of table</span>
<span class="kw">dbListFields</span>(<span class="dt">conn =</span> con, <span class="st">&quot;fb_data&quot;</span>)

<span class="co"># search table</span>
<span class="kw">dbListTables</span>(con)
<span class="kw">dbExistsTable</span>(<span class="dt">conn =</span> con, <span class="st">&quot;fb_data&quot;</span>)

<span class="co"># drop table</span>
<span class="kw">dbRemoveTable</span>(<span class="dt">conn =</span> con, <span class="st">&quot;fb_data&quot;</span>)

<span class="co"># check</span>
<span class="kw">dbListTables</span>(con)

<span class="co"># disconnect</span>
<span class="kw">dbDisconnect</span>(con)</code></pre></div>
</div>
<div id="-----google-bigquery" class="section level3">
<h3><span class="header-section-number">7.3.4</span> Работа с облачной базой данных Google BigQuery</h3>
<p>[Google BigQuery}(<a href="https://netpeak.net/ru/blog/google-bigquery-podrobnyy-obzor-funktsii/" class="uri">https://netpeak.net/ru/blog/google-bigquery-podrobnyy-obzor-funktsii/</a>) - Это облачная база данных с высочайшей скоростью обработки огромных массивов данных.</p>
<p>Для работы с Google BigQuery из R необходимо установить пакет bigrquery. Устновка из CRAN: <code>install.packages(&quot;bigrquery&quot;)</code> Установка из GitHub: <code>devtools::install_github(&quot;r-dbi/bigrquery&quot;)</code></p>
<p>В отличае от приведённых выше примеров взаимодействовать с BigQuery из R можно как через DBI интефейс, так и через низкоуровневный API интерфейс.</p>
<div id="--google-bigquery---api-" class="section level4">
<h4><span class="header-section-number">7.3.4.1</span> Взаимодействие с Google BigQuery через низкоуровневный API интерфейс</h4>
<p>Для начала приведу пример кода для загрузки данных из API Facebook, которые мы будем использовать в качестве примера для работы с SQLite.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rfacebookstat)
<span class="co"># fb load</span>
<span class="kw">load</span>(<span class="st">&quot;C:</span><span class="ch">\\</span><span class="st">r_for_marketing_course</span><span class="ch">\\</span><span class="st">Материалы курса</span><span class="ch">\\</span><span class="st">Модуль 2</span><span class="ch">\\</span><span class="st">Урок 4</span><span class="ch">\\</span><span class="st">fb_token.RData&quot;</span>)

my_fb_stats &lt;-<span class="st"> </span><span class="kw">fbGetMarketingStat</span>(<span class="dt">accounts_id =</span> <span class="st">&quot;act_262115113&quot;</span>,
                                  <span class="dt">level =</span> <span class="st">&quot;ad&quot;</span>,
                                  <span class="dt">fields =</span> <span class="st">&quot;campaign_name,ad_id,impressions,clicks&quot;</span>,
                                  <span class="dt">breakdowns =</span> <span class="st">&quot;impression_device&quot;</span>,
                                  <span class="dt">date_start =</span> <span class="kw">Sys.Date</span>() <span class="op">-</span><span class="st"> </span><span class="dv">20</span>,
                                  <span class="dt">date_stop =</span> <span class="kw">Sys.Date</span>() <span class="op">-</span><span class="st"> </span><span class="dv">11</span>,
                                  <span class="dt">interval =</span> <span class="st">&quot;day&quot;</span>,
                                  <span class="dt">access_token =</span> fb_token)</code></pre></div>
<p>Далее рассмотрим функции для работы с низкоуровневым API интерфейсом Google BigQuery.</p>
<ul>
<li><code>bq_table</code> - Обращение к таблице</li>
<li><code>bq_dataset</code> - Обращение к набору данных</li>
<li><code>bq_dataset_query</code> - Отправка запроса к набору данных</li>
<li><code>bq_project_query</code>- Отправка запроса к проекту</li>
<li><code>bq_table_upload</code> - Загрузка данных в таблицу</li>
<li><code>bq_table_download</code> - Загрузка таблицы из BigQuery в R</li>
<li><code>bq_table_exists</code> - Проверка наличия таблицы</li>
<li><code>bq_table_fields</code> - Получить список полей таблицы</li>
<li><code>bq_table_delete</code> - Удалить таблицу</li>
</ul>
<p><strong>Основные аргументы</strong></p>
<ul>
<li>project - ID проекта</li>
<li>dataset - Название набора данных</li>
<li>table - Название таблицы</li>
<li>values - Данные которые вы хотите записать в BigQuery</li>
<li>create_disposition - Что делать если заданная таблица не найдена в базе, CREATE_IF_NEEDED - создать при необходимости, CREATE_NEVER не создавать таблицу если такой таблицы нет в базе данных</li>
<li>write_disposition - Что делать если заданная таблица в которую вы хотите записать данные уже существует в базе:
<ul>
<li>WRITE_APPEND - Дописать новые данные под старыми</li>
<li>WRITE_EMPTY - Записать данные только если указанная таблица пустая</li>
<li>WRITE_TRUNCATE - Заменить старые данные новыми, перезапись таблицы</li>
</ul></li>
<li>use_legacy_sql - Использовать в запросе стандартный SQL Диалект</li>
</ul>
<p><strong>Пример работы с низкоуровневым API</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># write data</span>
<span class="kw">bq_table</span>(<span class="dt">project =</span> <span class="st">&quot;rcourse-215606&quot;</span>,
         <span class="dt">dataset =</span> <span class="st">&quot;course_ds&quot;</span>,
         <span class="dt">table   =</span> <span class="st">&quot;bq_fb&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">bq_table_upload</span>(<span class="dt">x =</span> .,
                  <span class="dt">values =</span> my_fb_stats,
                  <span class="dt">create_disposition =</span> <span class="st">&quot;CREATE_IF_NEEDED&quot;</span>,
                  <span class="dt">write_disposition =</span> <span class="st">&quot;WRITE_APPEND&quot;</span>)

<span class="co"># load table</span>
bq_table &lt;-<span class="st"> </span><span class="kw">bq_table</span>(<span class="dt">project =</span> <span class="st">&quot;rcourse-215606&quot;</span>,
                     <span class="dt">dataset =</span>  <span class="st">&quot;course_ds&quot;</span>,
                     <span class="dt">table =</span> <span class="st">&quot;bq_fb&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">              </span><span class="kw">bq_table_download</span>()

<span class="co"># load by sql</span>
sql_text &lt;-<span class="st"> &quot;SELECT impression_device, SUM(clicks) as clicks</span>
<span class="st">             FROM course_ds.bq_fb</span>
<span class="st">             GROUP BY impression_device&quot;</span>

<span class="co"># project</span>
bq_query_p &lt;-<span class="st"> </span><span class="kw">bq_project_query</span>(<span class="dt">x              =</span> <span class="st">&quot;rcourse-215606&quot;</span>,
                               <span class="dt">query          =</span> sql_text,
                               <span class="dt">use_legacy_sql =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span>
<span class="st">              </span><span class="kw">bq_table_download</span>()

<span class="co"># dataset</span>
sql_text &lt;-<span class="st"> &quot;SELECT impression_device, SUM(clicks) as clicks</span>
<span class="st">             FROM bq_fb</span>
<span class="st">             GROUP BY impression_device&quot;</span>

bq_query_ds &lt;-<span class="st"> </span><span class="kw">bq_dataset</span>(<span class="dt">project =</span> <span class="st">&quot;rcourse-215606&quot;</span>,<span class="dt">dataset =</span>  <span class="st">&quot;course_ds&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">                </span><span class="kw">bq_dataset_query</span>(<span class="dt">query =</span> sql_text) <span class="op">%&gt;%</span>
<span class="st">                </span><span class="kw">bq_table_download</span>()

<span class="co"># exist table</span>
<span class="kw">bq_table</span>(<span class="dt">project =</span> <span class="st">&quot;rcourse-215606&quot;</span>,<span class="dt">dataset =</span>  <span class="st">&quot;course_ds&quot;</span>, <span class="dt">table =</span> <span class="st">&quot;bq_fb&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">bq_table_exists</span>()

<span class="co"># fields</span>
<span class="kw">bq_table</span>(<span class="dt">project =</span> <span class="st">&quot;rcourse-215606&quot;</span>,<span class="dt">dataset =</span>  <span class="st">&quot;course_ds&quot;</span>, <span class="dt">table =</span> <span class="st">&quot;bq_fb&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">bq_table_fields</span>()

<span class="co"># remove table</span>
<span class="kw">bq_table</span>(<span class="dt">project =</span> <span class="st">&quot;rcourse-215606&quot;</span>,<span class="dt">dataset =</span>  <span class="st">&quot;course_ds&quot;</span>, <span class="dt">table =</span> <span class="st">&quot;bq_fb&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">bq_table_delete</span>()

<span class="kw">bq_table</span>(<span class="dt">project =</span> <span class="st">&quot;rcourse-215606&quot;</span>,<span class="dt">dataset =</span>  <span class="st">&quot;course_ds&quot;</span>, <span class="dt">table =</span> <span class="st">&quot;bq_fb&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">bq_table_exists</span>()</code></pre></div>
</div>
<div id="--bigquery--dbi" class="section level4">
<h4><span class="header-section-number">7.3.4.2</span> Работа с BigQuery через DBI</h4>
<p>Опять же разница с прошлыми примерам только в процессе подключения через функцию <code>dbConnect</code>, в качестве аргументов для работы с BigQuery вам необходимо указать <code>drv = bigquery()</code>, а так же передать в агрументы <em>project</em> и <em>dataset</em>, ID проекта и название набора данных соответсвенно.</p>
<p><strong>GПример работы через DBI интерфейс</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># DBI</span>
con &lt;-<span class="st"> </span><span class="kw">dbConnect</span>(<span class="dt">drv     =</span> <span class="kw">bigquery</span>(),
                 <span class="dt">project =</span> <span class="st">&quot;rcourse-215606&quot;</span>,
                 <span class="dt">dataset =</span> <span class="st">&quot;course_ds&quot;</span>)

<span class="co"># write</span>
<span class="kw">dbWriteTable</span>(<span class="dt">conn  =</span> con,
             <span class="dt">name  =</span> <span class="st">&quot;bq_fb&quot;</span>,
             <span class="dt">value =</span> my_fb_stats,
             <span class="dt">append    =</span> <span class="ot">TRUE</span>,
             <span class="dt">overwrite =</span> <span class="ot">FALSE</span>,
             <span class="dt">row.names =</span> <span class="ot">FALSE</span>)

<span class="co"># read</span>
bq_table_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">dbReadTable</span>(con, <span class="st">&quot;bq_fb&quot;</span>)

<span class="co"># read sql</span>
bq_sql     &lt;-<span class="st"> </span>DBI<span class="op">::</span><span class="kw">dbGetQuery</span>(<span class="dt">conn =</span> con,
                              <span class="dt">statement =</span> <span class="st">&quot;SELECT impression_device, SUM(clicks) as clicks</span>
<span class="st">                              FROM bq_fb</span>
<span class="st">                              GROUP BY impression_device&quot;</span>)

<span class="co"># fields of table</span>
<span class="kw">dbListFields</span>(<span class="dt">conn =</span> con, <span class="st">&quot;bq_fb&quot;</span>)

<span class="co"># search table</span>
<span class="kw">dbListTables</span>(con)
<span class="kw">dbExistsTable</span>(<span class="dt">conn =</span> con, <span class="st">&quot;bq_fb&quot;</span>)

<span class="co"># drop table</span>
<span class="kw">dbRemoveTable</span>(<span class="dt">conn =</span> con, <span class="st">&quot;bq_fb&quot;</span>)

<span class="co"># check</span>
<span class="kw">dbListTables</span>(con)

<span class="co"># disconnect</span>
<span class="kw">dbDisconnect</span>(con)</code></pre></div>
</div>
</div>
</div>
<p style="text-align: center;">
<a href="7-2-ggplot2.html"><button class="btn btn-default">Previous</button></a>
<a href="7-4-r.html"><button class="btn btn-default">Next</button></a>
</p>
</div>
</div>



</body>
</html>
