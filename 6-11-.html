<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta property="og:title" content="Язык R в интернет маркетинге" />
<meta property="og:type" content="book" />


<meta property="og:description" content="Методичесткое пособие к авторскому курсу Алексея Селезнёва “Язык R в интернет маркетинге.”" />
<meta name="github-repo" content="rstudio/bookdown-demo" />

<meta name="author" content="Алексей Селезнёв" />

<meta name="date" content="2018-10-03" />


<meta name="description" content="Методичесткое пособие к авторскому курсу Алексея Селезнёва “Язык R в интернет маркетинге.”">

<title>Язык R в интернет маркетинге</title>

<link href="libs/tufte-css-2015.12.29/tufte-fonts.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte-background.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte-italics.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte.css" rel="stylesheet" />


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



</head>

<body>



<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul>
<li><a href="index.html#section-1"><span class="toc-section-number">1</span> Описание</a></li>
<li class="has-sub"><a href="2-a-.html#a----"><span class="toc-section-number">2</span> a - О курсе</a><ul>
<li><a href="2-1-.html#---"><span class="toc-section-number">2.1</span> Для кого этот курс</a></li>
<li><a href="2-2-.html#-----"><span class="toc-section-number">2.2</span> Какие знания требуются для прохождения курса</a></li>
<li><a href="2-3-.html#-------"><span class="toc-section-number">2.3</span> Какие темы не будут затронуты в ходе курса</a></li>
<li><a href="2-4-.html#------"><span class="toc-section-number">2.4</span> Что вы будете уметь поосле проождения курса</a></li>
<li><a href="2-5-.html#-"><span class="toc-section-number">2.5</span> Поддержка студентов</a></li>
<li><a href="2-5-.html#-"><span class="toc-section-number">2.6</span> Конспект курса</a></li>
<li><a href="2-5-.html#-"><span class="toc-section-number">2.7</span> Программа курса</a></li>
</ul></li>
<li><a href="3-b-.html#b----"><span class="toc-section-number">3</span> b - Об авторе</a></li>
<li><a href="4-c-.html#c---"><span class="toc-section-number">4</span> c - Благодарности</a></li>
<li class="has-sub"><a href="5-1-r-.html#-1---r."><span class="toc-section-number">5</span> Модуль 1: Введение в R.</a><ul>
<li><a href="5-1-r.html#---r"><span class="toc-section-number">5.1</span> История создания языка R</a></li>
<li><a href="5-2-r-.html#--r."><span class="toc-section-number">5.2</span> Преимущества языка R.</a></li>
<li class="has-sub"><a href="5-3-r-rstudio.html#--r----rstudio"><span class="toc-section-number">5.3</span> Установка языка R и среды разработки RStudio</a><ul>
<li><a href="5-3-r-rstudio.html#---r--rstudio"><span class="toc-section-number">5.3.1</span> Ссылки для загрузки R и RStudio</a></li>
</ul></li>
<li class="has-sub"><a href="5-4-power-bi-r-.html#------power-bi---r-."><span class="toc-section-number">5.4</span> Загрузка, преобразование и визуализация данных в Power BI с помощью R скриптов.</a><ul>
<li><a href="5-4-power-bi-r-.html#---power-bi."><span class="toc-section-number">5.4.1</span> Загрузка данных в Power BI.</a></li>
<li><a href="5-4-power-bi-r-.html#---power-bi-power-query."><span class="toc-section-number">5.4.2</span> Преобразование данных в Power BI (power query).</a></li>
<li><a href="5-4-power-bi-r-.html#---power-bi------r."><span class="toc-section-number">5.4.3</span> Визуализация данных в Power BI с помощью визуального элемента скрипта R.</a></li>
<li><a href="5-4-power-bi-r-.html#---power-bi--r-."><span class="toc-section-number">5.4.4</span> Использование пользовательских параметров Power BI в R скриптах.</a></li>
</ul></li>
<li><a href="5-5-rstudio.html#--rstudio"><span class="toc-section-number">5.5</span> Среда разработки RStudio</a></li>
<li class="has-sub"><a href="5-6-r.html#----r"><span class="toc-section-number">5.6</span> Классы объектов в языке R</a><ul>
<li><a href="5-6-r.html#section-5.6.1"><span class="toc-section-number">5.6.1</span> Векторы</a></li>
<li><a href="5-6-r.html#-data.frame"><span class="toc-section-number">5.6.2</span> Таблицы (data.frame)</a></li>
<li><a href="5-6-r.html#-list"><span class="toc-section-number">5.6.3</span> Списки (list)</a></li>
<li><a href="5-6-r.html#--"><span class="toc-section-number">5.6.4</span> Проверить класс объекта</a></li>
</ul></li>
<li class="has-sub"><a href="5-7-r.html#-----r"><span class="toc-section-number">5.7</span> Работа со строками на языке R</a><ul>
<li><a href="5-7-r.html#-------r"><span class="toc-section-number">5.7.1</span> Базовые возможности для работы со строками в R</a></li>
<li><a href="5-7-r.html#------stringr"><span class="toc-section-number">5.7.2</span> Работа со строками с помощью пакета stringr</a></li>
</ul></li>
<li class="has-sub"><a href="5-8-csv-excel-json-r.html#---csv-excel--json---r"><span class="toc-section-number">5.8</span> Загрузка данных из csv, excel и json файлов в R</a><ul>
<li><a href="5-8-csv-excel-json-r.html#---csv-"><span class="toc-section-number">5.8.1</span> Загрузка данных из csv файлов</a></li>
<li><a href="5-8-csv-excel-json-r.html#---excel-"><span class="toc-section-number">5.8.2</span> Загрузка данных из Excel файлов</a></li>
<li><a href="5-8-csv-excel-json-r.html#---json-"><span class="toc-section-number">5.8.3</span> Загрузка данных из JSON файлов</a></li>
</ul></li>
<li><a href="5-9-r.html#------r"><span class="toc-section-number">5.9</span> Агрегирующие функции и арифметические операции в R</a></li>
<li class="has-sub"><a href="5-10-.html#-----."><span class="toc-section-number">5.10</span> Манипуляция с данными, (группировка и агреция).</a><ul>
<li><a href="5-10-.html#-dplyr"><span class="toc-section-number">5.10.1</span> Пакет dplyr</a></li>
<li><a href="5-10-.html#-data.table"><span class="toc-section-number">5.10.2</span> Пакет data.table</a></li>
<li><a href="5-10-.html#-sqldf"><span class="toc-section-number">5.10.3</span> Пакет sqldf</a></li>
<li><a href="5-10-.html#-tidyr"><span class="toc-section-number">5.10.4</span> Пакет tidyr</a></li>
</ul></li>
<li class="has-sub"><a href="5-11-r-lubridate-.html#------r--lubridate."><span class="toc-section-number">5.11</span> Работа с датами и временем в R, пакет lubridate.</a><ul>
<li><a href="5-11-r-lubridate-.html#---------r"><span class="toc-section-number">5.11.1</span> Базовые возможности по работе с датой и временем в R</a></li>
<li><a href="5-11-r-lubridate-.html#-lubridate"><span class="toc-section-number">5.11.2</span> Пакет lubridate</a></li>
</ul></li>
<li><a href="5-12-if-ifelse-switch-r.html#--if-ifelse-switch--r"><span class="toc-section-number">5.12</span> Условные конструкции if, ifelse, switch в R</a></li>
<li class="has-sub"><a href="5-13-for-while.html#-for--while"><span class="toc-section-number">5.13</span> Циклы for и while</a><ul>
<li><a href="5-13-for-while.html#-for"><span class="toc-section-number">5.13.1</span> Цикл for</a></li>
<li><a href="5-13-for-while.html#-while"><span class="toc-section-number">5.13.2</span> Цикл while</a></li>
</ul></li>
<li><a href="5-7-r.html#-----r"><span class="toc-section-number">5.14</span> Разработка собственных функций в языке R</a></li>
<li><a href="5-15-r-try.html#---r--try"><span class="toc-section-number">5.15</span> Обработка ошибок в R, функция try</a></li>
<li><a href="2-1-.html#---"><span class="toc-section-number">5.16</span> Рекомендации по оформлению кода</a></li>
</ul></li>
<li class="has-sub"><a href="6-2-api-.html#-2---api--."><span class="toc-section-number">6</span> Модуль 2: Работа с API рекламных площадок.</a><ul>
<li class="has-sub"><a href="6-1-api.html#--api"><span class="toc-section-number">6.1</span> Что такое API</a><ul>
<li><a href="6-1-api.html#-http-"><span class="toc-section-number">6.1.1</span> Типы HTTP запросов</a></li>
</ul></li>
<li class="has-sub"><a href="6-2-api-google-ads.html#--api-google-ads"><span class="toc-section-number">6.2</span> Работа с API Google Ads</a><ul>
<li><a href="6-2-api-google-ads.html#----api-google-ads"><span class="toc-section-number">6.2.1</span> Как получить доступ к API Google Ads</a></li>
<li><a href="6-2-api-google-ads.html#--api-google-ads"><span class="toc-section-number">6.2.2</span> Как устроен API Google Ads</a></li>
<li><a href="6-2-api-google-ads.html#-radwords"><span class="toc-section-number">6.2.3</span> Пакет RAdwords</a></li>
</ul></li>
<li class="has-sub"><a href="6-3-api-.html#--api--"><span class="toc-section-number">6.3</span> Работа с API Яндекс Директ</a><ul>
<li><a href="6-3-api-.html#-ryandexdirect"><span class="toc-section-number">6.3.1</span> Пакет ryandexdirect</a></li>
</ul></li>
<li class="has-sub"><a href="6-4-api-facebook.html#--api-facebook"><span class="toc-section-number">6.4</span> Работа с API Facebook</a><ul>
<li><a href="6-4-api-facebook.html#---facebook"><span class="toc-section-number">6.4.1</span> Создание приложения в Facebook</a></li>
<li><a href="6-4-api-facebook.html#--api-facebook"><span class="toc-section-number">6.4.2</span> Авторизация в API Facebook</a></li>
<li><a href="6-4-api-facebook.html#-----facebook"><span class="toc-section-number">6.4.3</span> Загрузка объектов из рекламного кабинета Facebook</a></li>
</ul></li>
<li class="has-sub"><a href="6-5-api-vk-com.html#--api--vk.com"><span class="toc-section-number">6.5</span> Работа с API Вконтакте (vk.com)</a><ul>
<li><a href="6-5-api-vk-com.html#-----api-"><span class="toc-section-number">6.5.1</span> Создание приложения для работы с API Вконтакте</a></li>
<li><a href="6-5-api-vk-com.html#--api-"><span class="toc-section-number">6.5.2</span> Авторизация в API Вконтакте</a></li>
<li><a href="6-5-api-vk-com.html#--rvkstat"><span class="toc-section-number">6.5.3</span> Функции пакета rvkstat</a></li>
<li><a href="2-2-.html#-----"><span class="toc-section-number">6.5.4</span> Загрузка объектов из рекламного кабинета Вконтакте</a></li>
<li><a href="2-2-.html#-----"><span class="toc-section-number">6.5.5</span> Загрузка статистики из рекламного кабинета Вконтакте</a></li>
<li><a href="2-4-.html#------"><span class="toc-section-number">6.5.6</span> Загрузка статистики по сообществам и группам Вконтакте</a></li>
</ul></li>
<li class="has-sub"><a href="6-6-api-mytarget.html#--api-mytarget"><span class="toc-section-number">6.6</span> Работа с API MyTarget</a><ul>
<li><a href="6-6-api-mytarget.html#--api-mytarget"><span class="toc-section-number">6.6.1</span> Авторизация в API MyTarget</a></li>
</ul></li>
<li class="has-sub"><a href="6-7-google-analytics.html#---google-analytics"><span class="toc-section-number">6.7</span> Загрузка данных из Google Analytics</a><ul>
<li><a href="6-7-google-analytics.html#-api----google-analytics"><span class="toc-section-number">6.7.1</span> Какие API интерфейсы доступны в Google Analytics</a></li>
<li><a href="6-7-google-analytics.html#--api-google-analytics"><span class="toc-section-number">6.7.2</span> Авторизация в API Google Analytics</a></li>
<li><a href="6-7-google-analytics.html#--management-api"><span class="toc-section-number">6.7.3</span> Работа с Management API</a></li>
<li><a href="6-7-google-analytics.html#--core-reporting-api"><span class="toc-section-number">6.7.4</span> Работа с Core Reporting API</a></li>
<li><a href="6-7-google-analytics.html#--multi-channel-funnels-api"><span class="toc-section-number">6.7.5</span> Работа с Multi-Channel Funnels API</a></li>
<li><a href="6-7-google-analytics.html#--real-time-reporting-api"><span class="toc-section-number">6.7.6</span> Работа с Real time reporting API</a></li>
</ul></li>
<li class="has-sub"><a href="6-3-api-.html#---api--"><span class="toc-section-number">6.8</span> Загрузка данных из API Яндекс Метрики</a><ul>
<li><a href="6-3-api-.html#----api--"><span class="toc-section-number">6.8.1</span> Авторизация для работы с API Яндекс Метрики</a></li>
<li><a href="6-8-api-.html#----api---"><span class="toc-section-number">6.8.2</span> Функции для работы с API управления Яндекс Метрики</a></li>
<li><a href="6-8-api-.html#---api---"><span class="toc-section-number">6.8.3</span> Загрузка данных из API отчётов Яндекс Метрики</a></li>
<li><a href="6-8-api-.html#---logs-api--"><span class="toc-section-number">6.8.4</span> Загрузка данных из Logs API Яндекс Метрики</a></li>
<li><a href="6-8-api-.html#---api-----core-reporting-api-google-analytics"><span class="toc-section-number">6.8.5</span> Загрузка данных из API Яндекс Метрики совместимого с Core Reporting API Google Analytics</a></li>
</ul></li>
<li class="has-sub"><a href="6-9-google-search-console.html#--google-search-console"><span class="toc-section-number">6.9</span> Работа с Google Search Console</a><ul>
<li><a href="6-9-google-search-console.html#----5000---1-"><span class="toc-section-number">6.9.1</span> Как обойти ограничение в 5000 строк на 1 запрос</a></li>
</ul></li>
<li class="has-sub"><a href="6-10-google-trends.html#--google-trends"><span class="toc-section-number">6.10</span> Работа с Google Trends</a><ul>
<li><a href="6-10-google-trends.html#-----google-trends"><span class="toc-section-number">6.10.1</span> Манипуляция с данными полученными из Google Trends</a></li>
</ul></li>
<li class="has-sub"><a href="5-6-r.html#--"><span class="toc-section-number">6.11</span> Парсинг веб сайтов</a><ul>
<li><a href="5-6-r.html#----"><span class="toc-section-number">6.11.1</span> Поиск элементов на веб странице</a></li>
<li><a href="6-11-.html#-----html-"><span class="toc-section-number">6.11.2</span> Извлечение значений из полученныз элементов HTML страницы</a></li>
<li><a href="2-1-.html#---"><span class="toc-section-number">6.11.3</span> Имитация пользовательской веб сессии</a></li>
</ul></li>
<li><a href="6-1-api.html#-http-"><span class="toc-section-number">6.12</span> отправка HTTP запросов</a></li>
</ul></li>
<li class="has-sub"><a href="7-3-api-.html#-3-----api----."><span class="toc-section-number">7</span> Модуль 3: Работа с загруженными из API интерфейсов различных сервисов данными.</a><ul>
<li><a href="7-1-google-.html#-----google-"><span class="toc-section-number">7.1</span> Отправка и стение данных из Google Таблиц</a></li>
<li class="has-sub"><a href="7-2-ggplot2.html#-----ggplot2"><span class="toc-section-number">7.2</span> Визуализация данных с помощью пакета ggplot2</a><ul>
<li><a href="7-2-ggplot2.html#---qplot"><span class="toc-section-number">7.2.1</span> Быстрый график, функция <code>qplot</code></a></li>
<li><a href="2-1-.html#---"><span class="toc-section-number">7.2.2</span> Построение графиков наложением слоёв</a></li>
</ul></li>
<li class="has-sub"><a href="7-3-dbi-.html#----dbi-------"><span class="toc-section-number">7.3</span> Работа с базами данных, DBI - Интерфейс взаимодействия с базами данных</a><ul>
<li><a href="7-3-dbi-.html#---mysql"><span class="toc-section-number">7.3.1</span> Работа с СУБД MySQL</a></li>
<li><a href="7-3-dbi-.html#----postgresql"><span class="toc-section-number">7.3.2</span> Работа с базой данных PostgreSQL</a></li>
<li><a href="7-3-dbi-.html#----sqlite"><span class="toc-section-number">7.3.3</span> Работа с базой данных SQLite</a></li>
<li><a href="7-3-dbi-.html#-----google-bigquery"><span class="toc-section-number">7.3.4</span> Работа с облачной базой данных Google BigQuery</a></li>
</ul></li>
<li><a href="5-6-r.html#----r"><span class="toc-section-number">7.4</span> Отправка почты с помощью R</a></li>
<li class="has-sub"><a href="7-5-r-.html#---r---"><span class="toc-section-number">7.5</span> Как настроить запуск R скриптов по рассписанию</a><ul>
<li><a href="2-1-.html#---"><span class="toc-section-number">7.5.1</span> Настройка расписание через плагин</a></li>
<li><a href="7-5-r-.html#------taskscheduler"><span class="toc-section-number">7.5.2</span> Настройка расписание с помощью функций пакета taskscheduleR</a></li>
<li><a href="7-5-r-.html#------windows"><span class="toc-section-number">7.5.3</span> Ручная настройка рассписания через планировщик задач Windows</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="8-r-r-sources.html#-----r-r-sources"><span class="toc-section-number">8</span> Полезные, русскоязычные ресурсы по языку R (r sources)</a><ul>
<li><a href="2-1-.html#---"><span class="toc-section-number">8.1</span> Группы в социальных сетях</a></li>
<li><a href="2-1-.html#---"><span class="toc-section-number">8.2</span> Телеграмм каналы и чаты</a></li>
<li><a href="8-3-section-8-3.html#section-8.3"><span class="toc-section-number">8.3</span> Блоги</a></li>
</ul></li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="--" class="section level2">
<h2><span class="header-section-number">6.11</span> Парсинг веб сайтов</h2>
<p>Забегая наперёд скажу, что данный урок (2 модуль, 10 урок) значительно проще понять при просмотре видео, чем при чтении конспекта курса.</p>
<p>Итак, наиболее удобный способ сбора данных с веб страниц в R предосталвяет пакет <code>rvest</code>, с помощью его функций вы можете:</p>
<ul>
<li>Собирать информации с веб страниц с помошью css селекторов или xpath локаторов.</li>
<li>Взаимодейтсвовать с различными элементами сайта, например отправлять формы.</li>
<li>Имитировать пользовательские сессии, начиная от процесса авторизации.</li>
</ul>
<div id="----" class="section level3">
<h3><span class="header-section-number">6.11.1</span> Поиск элементов на веб странице</h3>
<p>Перед тем как приступить к парсингу HTML страницы е необходимо загрузить в R с помощью команды <code>simpl_html &lt;- read_html(&quot;test_html_page.html&quot;)</code>, ’nf эта команда загрузит страницу которую вы можете найти в материалах курса в папаке <em>“Модуль 2/Урок 10/test_html_page.html”</em>, после чего в вашем рабочем окружении будет создан объект содержащий всю информацию из HTML страницы. В качестве аргумента функции можно указывать путь к локальной HTML странице как в приведённом примере, так и URL адрес любой доступной в интернете HTML страницы.</p>
<p><strong>HTML разметка тестовой, локальной страницы</strong></p>
<div class="sourceCode"><pre class="sourceCode html"><code class="sourceCode html"><span class="kw">&lt;h1&gt;</span> Is the test page <span class="kw">&lt;/h1&gt;</span>
<span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">&quot;simple_text&quot;</span><span class="kw">&gt;</span>
<span class="kw">&lt;p</span><span class="ot"> id=</span><span class="st">&#39;first_paragraph&#39;</span><span class="kw">&gt;</span> Is a test page for web scrapping by R and R package rvest<span class="kw">&lt;/p&gt;</span>
<span class="kw">&lt;p&gt;</span> For detail you can go to the rvest tutorial by this <span class="kw">&lt;a</span><span class="ot"> id=</span><span class="st">&#39;link1&#39;</span><span class="ot"> href=</span><span class="st">&#39;https://stat4701.github.io/edav/2015/04/02/rvest_tutorial/&#39;</span><span class="kw">&gt;</span>link<span class="kw">&lt;/a&gt;</span>.<span class="kw">&lt;/p&gt;</span>
<span class="kw">&lt;/div&gt;</span>

<span class="kw">&lt;div</span><span class="ot"> id=</span><span class="st">&quot;photo&quot;</span><span class="ot"> title=</span><span class="st">&#39;ph&#39;</span><span class="kw">&gt;</span>
<span class="kw">&lt;img</span><span class="ot"> src=</span><span class="st">&quot;https://i.ytimg.com/vi/jyqnbUNEO00/maxresdefault.jpg&quot;</span><span class="ot"> width=</span><span class="st">&quot;500&quot;</span><span class="kw">&gt;</span>
<span class="kw">&lt;/div&gt;</span>
<span class="kw">&lt;h2&gt;</span> Simple table for test <span class="kw">&lt;/h2&gt;</span>
<span class="kw">&lt;table</span><span class="ot"> class=</span><span class="st">&#39;tab&#39;</span><span class="ot"> id=</span><span class="st">&#39;t1&#39;</span><span class="ot"> border=</span><span class="st">&quot;1&quot;</span><span class="ot"> cellpadding=</span><span class="st">&quot;5&quot;</span><span class="ot"> title=</span><span class="st">&#39;test_tab&#39;</span><span class="kw">&gt;</span>
    <span class="kw">&lt;tr&gt;&lt;td&gt;</span>Id<span class="kw">&lt;/td&gt;&lt;td&gt;</span>Value<span class="kw">&lt;/td&gt;&lt;td&gt;</span>Age<span class="kw">&lt;/td&gt;&lt;/tr&gt;</span>
    <span class="kw">&lt;tr&gt;&lt;td&gt;</span>1<span class="kw">&lt;/td&gt;&lt;td&gt;</span>Alexey<span class="kw">&lt;/td&gt;&lt;td&gt;</span>34<span class="kw">&lt;/td&gt;&lt;/tr&gt;</span>
    <span class="kw">&lt;tr&gt;&lt;td&gt;</span>2<span class="kw">&lt;/td&gt;&lt;td&gt;</span>Nick<span class="kw">&lt;/td&gt;&lt;td&gt;</span>23<span class="kw">&lt;/td&gt;&lt;/tr&gt;</span>
    <span class="kw">&lt;tr&gt;&lt;td&gt;</span>3<span class="kw">&lt;/td&gt;&lt;td&gt;</span>Denis<span class="kw">&lt;/td&gt;&lt;td&gt;</span>38<span class="kw">&lt;/td&gt;&lt;/tr&gt;</span>
    <span class="kw">&lt;tr&gt;&lt;td&gt;</span>4<span class="kw">&lt;/td&gt;&lt;td&gt;</span>Andrey<span class="kw">&lt;/td&gt;&lt;td&gt;</span>29<span class="kw">&lt;/td&gt;&lt;/tr&gt;</span>
<span class="kw">&lt;/table&gt;</span>

<span class="kw">&lt;h2&gt;</span> Total rows in table <span class="kw">&lt;/h2&gt;</span>
<span class="kw">&lt;p</span><span class="ot"> id=</span><span class="st">&#39;last_paragraph&#39;</span><span class="ot"> class=</span><span class="st">&quot;simple_text&quot;</span><span class="kw">&gt;</span> Test table has four rows. 


<span class="kw">&lt;p</span><span class="ot"> id=</span><span class="st">&quot;update_date&quot;</span><span class="kw">&gt;&lt;i&gt;</span>2018-08-15<span class="kw">&lt;/i&gt;&lt;/p&gt;</span></code></pre></div>
<p>Для поиска какого либо конкретного элемента странцинаиболее удобно использовать CSS селекторы. Гораздо проще вам будет разобраться в данной теме если вы имеете хотя бы базовые знания в HTML разметке, на всякий случай приведу несколько определений которые мы будем использовать.</p>
<ul>
<li>HTML тег - элемент языка разметки гипертекста. Текст, содержащийся между начальным и конечным тегом, отображается и размещается в соответствии со свойствами, указанными в начальном теге.</li>
<li>Атрибуты - У тега могут быть свойства, называемые атрибутами, дающие дополнительные возможности форматирования текста. Они записываются в виде сочетания: имя атрибута-значения, причём текстовые значения заключаются в кавычки.</li>
<li>Атрибут id - Определяет уникальный идентификатор HTML элемента (его значение должно быть уникально для всего HTML документа).</li>
<li>Атрибут class - Определяет группу HTML элементов.</li>
</ul>
<p>На самом деле CSS селекторы это тема для отдельного большого курса, но в принципе вы без проблем можете найти какое нибудь видео на youtube или статью для того, чо бы более глубоко с ними ознакомистся, в этой книге я приведу пример наиболее простых и часто используемых селекторов.</p>
<ul>
<li><h1 id="update_date-------id-------idupdate_date"><span class="header-section-number">6.11.1</span> update_date - Поиск элемента по его id, в данном случае поиск элемента с id=“update_date”</h1></li>
<li>.simple_text - Поиск элемента по его классу, в данном случае поиск элемента с class=“simple_text”</li>
<li>[title] - Поиск по наличию атрибута, в данном случае мы выдерем все элементы в тегах которых присутвует атрибут title</li>
<li>[title=‘test_tab’] - Поиск элементов по значению атрибута, в данном случае мы выберем элементы в которых атрибут title равен “test_tab”</li>
<li>table - Поиск элемента по названия тега, в данном случае мы выберем все элементы которые находятся внутри тега table</li>
<li>div p a - Вложенные селекторы, в данном случае мы сначала ищем элемент внутри тега div, далее внутри него ищем элемент находящийся внутри тега p после чего внутри него ищем элемент внутри тега a, далее в примере будет прозе это понять.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Поиск элемента по ID</span>
date_node_css_id    &lt;-<span class="st"> </span><span class="kw">html_nodes</span>(<span class="dt">x =</span> simpl_html, <span class="dt">css =</span> <span class="st">&quot;#update_date&quot;</span>) 

<span class="co"># Поиск элемента по классу</span>
searh_class &lt;-<span class="st"> </span><span class="kw">html_nodes</span>(simpl_html, <span class="dt">css =</span> <span class="st">&quot;.simple_text&quot;</span>)

<span class="co"># Поиск по наличию атрибута</span>
attr_presence &lt;-<span class="st"> </span><span class="kw">html_nodes</span>(simpl_html, <span class="dt">css =</span> <span class="st">&quot;[title]&quot;</span>)

<span class="co"># Поиск по значению атрибута</span>
attr_value  &lt;-<span class="st"> </span><span class="kw">html_nodes</span>(simpl_html, <span class="dt">css =</span> <span class="st">&quot;[title=&#39;test_tab&#39;]&quot;</span>)

<span class="co"># Поиск по тегу</span>
tags        &lt;-<span class="st"> </span><span class="kw">html_nodes</span>(simpl_html, <span class="dt">css =</span> <span class="st">&quot;table&quot;</span>)

<span class="co"># Вложенные селекторы</span>
many_selectors &lt;-<span class="st"> </span><span class="kw">html_nodes</span>(simpl_html, <span class="dt">css =</span> <span class="st">&quot;div p a&quot;</span>)</code></pre></div>
</div>
<div id="-----html-" class="section level3">
<h3><span class="header-section-number">6.11.2</span> Извлечение значений из полученныз элементов HTML страницы</h3>
<p>В прошлом примере мы создали 6 новых объектов в рабочем окружении, все эти объекты являются элементами HTML срнацы, далее из этих элементов мы можем получить некоторые значения с помощью функций:</p>
<ul>
<li>html_text - получить текст находящийся внутри элемента</li>
<li>html_attrs - получить список атрибутов элемента</li>
<li>html_attr - получить значение одного конкретного атриута по его имени</li>
<li>html_name - получить имя тега</li>
<li>html_table - парсинг таблиц с веб страницы</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># извлечение текста</span>
txt_date      &lt;-<span class="st"> </span><span class="kw">html_text</span>(date_node_css_id)
<span class="co"># извлечение атрибутов</span>
txt_attr      &lt;-<span class="st"> </span><span class="kw">html_attrs</span>(searh_class)
<span class="co"># извлечение значения конкретного атрибута</span>
txt_attr_val  &lt;-<span class="st"> </span><span class="kw">html_attr</span>(searh_class[[<span class="dv">2</span>]], <span class="dt">name =</span> <span class="st">&quot;id&quot;</span>)
links_url     &lt;-<span class="st"> </span><span class="kw">html_nodes</span>(simpl_html, <span class="dt">css =</span> <span class="st">&quot;a&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_attr</span>(<span class="dt">name =</span> <span class="st">&quot;href&quot;</span>)
links_text    &lt;-<span class="st"> </span><span class="kw">html_nodes</span>(simpl_html, <span class="dt">css =</span> <span class="st">&quot;a&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_text</span>()
<span class="co"># названия тегов</span>
tag_names_txt &lt;-<span class="st"> </span><span class="kw">html_name</span>(searh_class)
<span class="co"># парсинг таблиц</span>
my_table      &lt;-<span class="st"> </span><span class="kw">html_nodes</span>(simpl_html, <span class="dt">css =</span> <span class="st">&quot;table&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_table</span>(<span class="dt">header =</span> <span class="ot">TRUE</span>)
my_tab &lt;-<span class="st"> </span>my_table[[<span class="dv">1</span>]]</code></pre></div>
</div>
<div id="---" class="section level3">
<h3><span class="header-section-number">6.11.3</span> Имитация пользовательской веб сессии</h3>
<p>Так же с помощью пакета <code>rvest</code> можно имитировать пользовательские сессии, в этом вам помогут следующие фукнции.</p>
<ul>
<li>html_session - Начать пользовательскую сессию</li>
<li>jump_to - Перейти по ссылке</li>
<li>follow_link - Найти ссылку по её тексту и перейти по этой ссылке</li>
<li>back - Вернутся на предыдущую посещённую страницу в ходе сессии</li>
<li>html_form - Получить все формы на странице</li>
<li>set_values - Заполнить поля формы</li>
<li>submit_form - Отправить форму</li>
<li>session_history - Посмотреть всю историю сессии</li>
</ul>
<p><strong>Пример имитации пользовательской сессии на сайте rutracker.org</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rvest)

<span class="co"># Создаём сессию</span>
session &lt;-<span class="st"> </span><span class="kw">html_session</span>(<span class="st">&quot;http://rutracker.org/forum/index.php&quot;</span>)
<span class="co"># Получаем форму для аутентификации пользователя</span>
all_form &lt;-<span class="st"> </span><span class="kw">html_form</span>(session)
login_form &lt;-<span class="st"> </span><span class="kw">html_nodes</span>(session, <span class="dt">css =</span> <span class="st">&quot;#login-form-quick&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_form</span>() <span class="op">%&gt;%</span><span class="st"> </span>.[[<span class="dv">1</span>]]

<span class="co"># Заполняем форму</span>
filled_form &lt;-<span class="st"> </span><span class="kw">set_values</span>(login_form,
                          <span class="st">&quot;login_username&quot;</span> =<span class="st"> &quot;ваш_логин&quot;</span>,
                          <span class="st">&quot;login_password&quot;</span> =<span class="st"> &quot;ваш_пароль&quot;</span>)
<span class="co"># Отправляем её</span>
<span class="kw">submit_form</span>(session, filled_form)
<span class="co"># Переходим на главную страницу сайта</span>
main      &lt;-<span class="st"> </span><span class="kw">jump_to</span>(session, <span class="st">&quot;http://rutracker.org/forum/index.php&quot;</span>)
username  &lt;-<span class="st"> </span><span class="kw">html_nodes</span>(main, <span class="st">&quot;.logged-in-as-uname&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_text</span>()
prof_link &lt;-<span class="st"> </span><span class="kw">html_nodes</span>(main, <span class="st">&quot;.logged-in-as-uname&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_attr</span>(<span class="st">&quot;href&quot;</span>)
prof      &lt;-<span class="st"> </span><span class="kw">jump_to</span>(session, prof_link)

my_stag_hours &lt;-<span class="st"> </span><span class="kw">html_nodes</span>(prof,<span class="st">&#39;table[class=&quot;user_details borderless w100&quot;] b&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span>.[<span class="dv">3</span>] <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_text</span>()

df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">username =</span> username,
                 <span class="dt">stag =</span> my_stag_hours)

tabl &lt;-<span class="st"> </span><span class="kw">html_nodes</span>(prof,<span class="st">&#39;table[class=&quot;user_details borderless w100&quot;]&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_table</span>()
tabl &lt;-<span class="st"> </span><span class="kw">data.frame</span>(tabl)

<span class="co"># список ссылок</span>
<span class="kw">html_nodes</span>(prof, <span class="st">&quot;a&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_text</span>()

rules &lt;-<span class="st"> </span><span class="kw">follow_link</span>(session, <span class="st">&quot;Правила&quot;</span>)

<span class="kw">html_nodes</span>(rules, <span class="st">&quot;.post_body&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_text</span>()

<span class="kw">session_history</span>(session)</code></pre></div>
<p>Первое что мы делаем это создаём с помощью команды <code>html_session(&quot;http://rutracker.org/forum/index.php&quot;)</code> веб сессию на сайте <a href="http://rutracker.org" class="uri">http://rutracker.org</a> и создаём новый объект <em>session</em>.</p>
<p>Далее мы с помощью функции <code>html_form(session)</code> получаем все формы со страницы.</p>
<p>Но нам нужна форма Id которой login-form-quick, поэтому мы получаем этот элеент, далее считываем форму и получаем первый элемент из листа хранещего формы. <code>login_form &lt;- html_nodes(session, css = &quot;#login-form-quick&quot;) %&gt;% html_form() %&gt;% .[[1]]</code>.</p>
<p>Теперь нам надо заполнить форму, т.е. ввести свой логин и пароль.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">filled_form &lt;-<span class="st"> </span><span class="kw">set_values</span>(login_form,
                          <span class="st">&quot;login_username&quot;</span> =<span class="st"> &quot;ваш_логин&quot;</span>,
                          <span class="st">&quot;login_password&quot;</span> =<span class="st"> &quot;ваш_пароль&quot;</span>)</code></pre></div>
<p>И отправляем заполненную форму с помощью <code>submit_form(session, filled_form)</code>.</p>
<p>Далее мы переходим на главную страницу <code>main &lt;- jump_to(session, &quot;http://rutracker.org/forum/index.php&quot;)</code> и для того что бы убедиться что мы уже авторизовались считаем имя пользователя, и заодно ссылку на переход в профиль пользователя.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">username  &lt;-<span class="st"> </span><span class="kw">html_nodes</span>(main, <span class="st">&quot;.logged-in-as-uname&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_text</span>()
prof_link &lt;-<span class="st"> </span><span class="kw">html_nodes</span>(main, <span class="st">&quot;.logged-in-as-uname&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_attr</span>(<span class="st">&quot;href&quot;</span>)</code></pre></div>
<p>Теперь мы можем перейти в свой профиль по полученной ссылке - <code>prof &lt;- jump_to(session, prof_link)</code>.</p>
<p>Далее мы можем получить некорую информацию из своего профиля, например свой стаж на rutracker, давайте для этого выполним команду <code>my_stag_hours &lt;- html_nodes(prof,'table[class=&quot;user_details borderless w100&quot;] b') %&gt;% .[3] %&gt;% html_text()</code>. В данном случае мы загрузили элемен который является таблицей (тег table) и имеет класс “user_details borderless w100”, получить тег, класс и любые атрибуты элемента,а так же полный путь css селектора к этому элементу можно прямо в браузере:</p>
<div class="figure">
<img src="r_for_marketing_2018_files/figure-html/css_copy.gif" alt="Получить css селектор в Google Chrome" />
<p class="caption">Получить css селектор в Google Chrome</p>
</div>
<p>Как вы видите из gif-ки, для того что бы получить css селектор какого либо объекта, вам необходимо в раузере выделить этот объект, нажать правую кнопку мышки и в меню выбрать “Посмотреть код”, после чего откроется окно в котором буден виден HTML код страницы и опять же нажав по нужному элементу в коде правой кнокпой мышив открывшемся менюбудет пункт Copy, и уже в нём вам досупны команды copy selector и copy xPath, с помощью первой команды вы скопируете css селектор, с помощью второй xPath локатор.</p>
<p>Из полученных данных о имени пользователя и его стаже можно сформировать дата фрейм.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">username =</span> username,
                 <span class="dt">stag =</span> my_stag_hours)</code></pre></div>
<p>Так же мы можем получить таблицу со всей информацией о вашем профиле:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tabl &lt;-<span class="st"> </span><span class="kw">html_nodes</span>(prof,<span class="st">&#39;table[class=&quot;user_details borderless w100&quot;]&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_table</span>()
tabl &lt;-<span class="st"> </span><span class="kw">data.frame</span>(tabl)</code></pre></div>
<p>С помощью команды <code>html_nodes(prof, &quot;a&quot;) %&gt;% html_text()</code> мы можем получить вектор состоящий из текста прикреплённого ко всем ссылкам на текущей странице.</p>
<p>К одной из полученных ссылок прикреплён текст “Правила”, которая соответсвенно ведёт на страницу правил, для того что бы перейти по данной ссылке по прикреплённому тексту можно выполнить команду <code>rules &lt;- follow_link(session, &quot;Правила&quot;)</code>, а для того что бы получить первое сообщение мообщение со страницы правил можно выполнить следующую команду <code>html_nodes(rules, &quot;.post_body&quot;) %&gt;% html_text()</code>.</p>
<p>Текстом довольно сложно раскрыть тему парсинга сайтов, поэтому я всё же рекомендую пройти видео урок.</p>
</div>
</div>
<p style="text-align: center;">
<a href="6-10-google-trends.html"><button class="btn btn-default">Previous</button></a>
<a href="6-12-http-.html"><button class="btn btn-default">Next</button></a>
</p>
</div>
</div>



</body>
</html>
