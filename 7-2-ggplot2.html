<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta property="og:title" content="Язык R в интернет маркетинге" />
<meta property="og:type" content="book" />


<meta property="og:description" content="Методичесткое пособие к авторскому курсу Алексея Селезнёва “Язык R в интернет маркетинге.”" />
<meta name="github-repo" content="rstudio/bookdown-demo" />

<meta name="author" content="Алексей Селезнёв" />

<meta name="date" content="2018-10-03" />


<meta name="description" content="Методичесткое пособие к авторскому курсу Алексея Селезнёва “Язык R в интернет маркетинге.”">

<title>Язык R в интернет маркетинге</title>

<link href="libs/tufte-css-2015.12.29/tufte-fonts.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte-background.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte-italics.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte.css" rel="stylesheet" />


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



</head>

<body>



<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul>
<li><a href="index.html#section-1"><span class="toc-section-number">1</span> Описание</a></li>
<li class="has-sub"><a href="2-a-.html#a----"><span class="toc-section-number">2</span> a - О курсе</a><ul>
<li><a href="2-1-.html#---"><span class="toc-section-number">2.1</span> Для кого этот курс</a></li>
<li><a href="2-2-.html#-----"><span class="toc-section-number">2.2</span> Какие знания требуются для прохождения курса</a></li>
<li><a href="2-3-.html#-------"><span class="toc-section-number">2.3</span> Какие темы не будут затронуты в ходе курса</a></li>
<li><a href="2-4-.html#------"><span class="toc-section-number">2.4</span> Что вы будете уметь поосле проождения курса</a></li>
<li><a href="2-5-.html#-"><span class="toc-section-number">2.5</span> Поддержка студентов</a></li>
<li><a href="2-5-.html#-"><span class="toc-section-number">2.6</span> Конспект курса</a></li>
<li><a href="2-5-.html#-"><span class="toc-section-number">2.7</span> Программа курса</a></li>
</ul></li>
<li><a href="3-b-.html#b----"><span class="toc-section-number">3</span> b - Об авторе</a></li>
<li><a href="4-c-.html#c---"><span class="toc-section-number">4</span> c - Благодарности</a></li>
<li class="has-sub"><a href="5-1-r-.html#-1---r."><span class="toc-section-number">5</span> Модуль 1: Введение в R.</a><ul>
<li><a href="5-1-r.html#---r"><span class="toc-section-number">5.1</span> История создания языка R</a></li>
<li><a href="5-2-r-.html#--r."><span class="toc-section-number">5.2</span> Преимущества языка R.</a></li>
<li class="has-sub"><a href="5-3-r-rstudio.html#--r----rstudio"><span class="toc-section-number">5.3</span> Установка языка R и среды разработки RStudio</a><ul>
<li><a href="5-3-r-rstudio.html#---r--rstudio"><span class="toc-section-number">5.3.1</span> Ссылки для загрузки R и RStudio</a></li>
</ul></li>
<li class="has-sub"><a href="5-4-power-bi-r-.html#------power-bi---r-."><span class="toc-section-number">5.4</span> Загрузка, преобразование и визуализация данных в Power BI с помощью R скриптов.</a><ul>
<li><a href="5-4-power-bi-r-.html#---power-bi."><span class="toc-section-number">5.4.1</span> Загрузка данных в Power BI.</a></li>
<li><a href="5-4-power-bi-r-.html#---power-bi-power-query."><span class="toc-section-number">5.4.2</span> Преобразование данных в Power BI (power query).</a></li>
<li><a href="5-4-power-bi-r-.html#---power-bi------r."><span class="toc-section-number">5.4.3</span> Визуализация данных в Power BI с помощью визуального элемента скрипта R.</a></li>
<li><a href="5-4-power-bi-r-.html#---power-bi--r-."><span class="toc-section-number">5.4.4</span> Использование пользовательских параметров Power BI в R скриптах.</a></li>
</ul></li>
<li><a href="5-5-rstudio.html#--rstudio"><span class="toc-section-number">5.5</span> Среда разработки RStudio</a></li>
<li class="has-sub"><a href="5-6-r.html#----r"><span class="toc-section-number">5.6</span> Классы объектов в языке R</a><ul>
<li><a href="5-6-r.html#section-5.6.1"><span class="toc-section-number">5.6.1</span> Векторы</a></li>
<li><a href="5-6-r.html#-data.frame"><span class="toc-section-number">5.6.2</span> Таблицы (data.frame)</a></li>
<li><a href="5-6-r.html#-list"><span class="toc-section-number">5.6.3</span> Списки (list)</a></li>
<li><a href="5-6-r.html#--"><span class="toc-section-number">5.6.4</span> Проверить класс объекта</a></li>
</ul></li>
<li class="has-sub"><a href="5-7-r.html#-----r"><span class="toc-section-number">5.7</span> Работа со строками на языке R</a><ul>
<li><a href="5-7-r.html#-------r"><span class="toc-section-number">5.7.1</span> Базовые возможности для работы со строками в R</a></li>
<li><a href="5-7-r.html#------stringr"><span class="toc-section-number">5.7.2</span> Работа со строками с помощью пакета stringr</a></li>
</ul></li>
<li class="has-sub"><a href="5-8-csv-excel-json-r.html#---csv-excel--json---r"><span class="toc-section-number">5.8</span> Загрузка данных из csv, excel и json файлов в R</a><ul>
<li><a href="5-8-csv-excel-json-r.html#---csv-"><span class="toc-section-number">5.8.1</span> Загрузка данных из csv файлов</a></li>
<li><a href="5-8-csv-excel-json-r.html#---excel-"><span class="toc-section-number">5.8.2</span> Загрузка данных из Excel файлов</a></li>
<li><a href="5-8-csv-excel-json-r.html#---json-"><span class="toc-section-number">5.8.3</span> Загрузка данных из JSON файлов</a></li>
</ul></li>
<li><a href="5-9-r.html#------r"><span class="toc-section-number">5.9</span> Агрегирующие функции и арифметические операции в R</a></li>
<li class="has-sub"><a href="5-10-.html#-----."><span class="toc-section-number">5.10</span> Манипуляция с данными, (группировка и агреция).</a><ul>
<li><a href="5-10-.html#-dplyr"><span class="toc-section-number">5.10.1</span> Пакет dplyr</a></li>
<li><a href="5-10-.html#-data.table"><span class="toc-section-number">5.10.2</span> Пакет data.table</a></li>
<li><a href="5-10-.html#-sqldf"><span class="toc-section-number">5.10.3</span> Пакет sqldf</a></li>
<li><a href="5-10-.html#-tidyr"><span class="toc-section-number">5.10.4</span> Пакет tidyr</a></li>
</ul></li>
<li class="has-sub"><a href="5-11-r-lubridate-.html#------r--lubridate."><span class="toc-section-number">5.11</span> Работа с датами и временем в R, пакет lubridate.</a><ul>
<li><a href="5-11-r-lubridate-.html#---------r"><span class="toc-section-number">5.11.1</span> Базовые возможности по работе с датой и временем в R</a></li>
<li><a href="5-11-r-lubridate-.html#-lubridate"><span class="toc-section-number">5.11.2</span> Пакет lubridate</a></li>
</ul></li>
<li><a href="5-12-if-ifelse-switch-r.html#--if-ifelse-switch--r"><span class="toc-section-number">5.12</span> Условные конструкции if, ifelse, switch в R</a></li>
<li class="has-sub"><a href="5-13-for-while.html#-for--while"><span class="toc-section-number">5.13</span> Циклы for и while</a><ul>
<li><a href="5-13-for-while.html#-for"><span class="toc-section-number">5.13.1</span> Цикл for</a></li>
<li><a href="5-13-for-while.html#-while"><span class="toc-section-number">5.13.2</span> Цикл while</a></li>
</ul></li>
<li><a href="5-7-r.html#-----r"><span class="toc-section-number">5.14</span> Разработка собственных функций в языке R</a></li>
<li><a href="5-15-r-try.html#---r--try"><span class="toc-section-number">5.15</span> Обработка ошибок в R, функция try</a></li>
<li><a href="2-1-.html#---"><span class="toc-section-number">5.16</span> Рекомендации по оформлению кода</a></li>
</ul></li>
<li class="has-sub"><a href="6-2-api-.html#-2---api--."><span class="toc-section-number">6</span> Модуль 2: Работа с API рекламных площадок.</a><ul>
<li class="has-sub"><a href="6-1-api.html#--api"><span class="toc-section-number">6.1</span> Что такое API</a><ul>
<li><a href="6-1-api.html#-http-"><span class="toc-section-number">6.1.1</span> Типы HTTP запросов</a></li>
</ul></li>
<li class="has-sub"><a href="6-2-api-google-ads.html#--api-google-ads"><span class="toc-section-number">6.2</span> Работа с API Google Ads</a><ul>
<li><a href="6-2-api-google-ads.html#----api-google-ads"><span class="toc-section-number">6.2.1</span> Как получить доступ к API Google Ads</a></li>
<li><a href="6-2-api-google-ads.html#--api-google-ads"><span class="toc-section-number">6.2.2</span> Как устроен API Google Ads</a></li>
<li><a href="6-2-api-google-ads.html#-radwords"><span class="toc-section-number">6.2.3</span> Пакет RAdwords</a></li>
</ul></li>
<li class="has-sub"><a href="6-3-api-.html#--api--"><span class="toc-section-number">6.3</span> Работа с API Яндекс Директ</a><ul>
<li><a href="6-3-api-.html#-ryandexdirect"><span class="toc-section-number">6.3.1</span> Пакет ryandexdirect</a></li>
</ul></li>
<li class="has-sub"><a href="6-4-api-facebook.html#--api-facebook"><span class="toc-section-number">6.4</span> Работа с API Facebook</a><ul>
<li><a href="6-4-api-facebook.html#---facebook"><span class="toc-section-number">6.4.1</span> Создание приложения в Facebook</a></li>
<li><a href="6-4-api-facebook.html#--api-facebook"><span class="toc-section-number">6.4.2</span> Авторизация в API Facebook</a></li>
<li><a href="6-4-api-facebook.html#-----facebook"><span class="toc-section-number">6.4.3</span> Загрузка объектов из рекламного кабинета Facebook</a></li>
</ul></li>
<li class="has-sub"><a href="6-5-api-vk-com.html#--api--vk.com"><span class="toc-section-number">6.5</span> Работа с API Вконтакте (vk.com)</a><ul>
<li><a href="6-5-api-vk-com.html#-----api-"><span class="toc-section-number">6.5.1</span> Создание приложения для работы с API Вконтакте</a></li>
<li><a href="6-5-api-vk-com.html#--api-"><span class="toc-section-number">6.5.2</span> Авторизация в API Вконтакте</a></li>
<li><a href="6-5-api-vk-com.html#--rvkstat"><span class="toc-section-number">6.5.3</span> Функции пакета rvkstat</a></li>
<li><a href="2-2-.html#-----"><span class="toc-section-number">6.5.4</span> Загрузка объектов из рекламного кабинета Вконтакте</a></li>
<li><a href="2-2-.html#-----"><span class="toc-section-number">6.5.5</span> Загрузка статистики из рекламного кабинета Вконтакте</a></li>
<li><a href="2-4-.html#------"><span class="toc-section-number">6.5.6</span> Загрузка статистики по сообществам и группам Вконтакте</a></li>
</ul></li>
<li class="has-sub"><a href="6-6-api-mytarget.html#--api-mytarget"><span class="toc-section-number">6.6</span> Работа с API MyTarget</a><ul>
<li><a href="6-6-api-mytarget.html#--api-mytarget"><span class="toc-section-number">6.6.1</span> Авторизация в API MyTarget</a></li>
</ul></li>
<li class="has-sub"><a href="6-7-google-analytics.html#---google-analytics"><span class="toc-section-number">6.7</span> Загрузка данных из Google Analytics</a><ul>
<li><a href="6-7-google-analytics.html#-api----google-analytics"><span class="toc-section-number">6.7.1</span> Какие API интерфейсы доступны в Google Analytics</a></li>
<li><a href="6-7-google-analytics.html#--api-google-analytics"><span class="toc-section-number">6.7.2</span> Авторизация в API Google Analytics</a></li>
<li><a href="6-7-google-analytics.html#--management-api"><span class="toc-section-number">6.7.3</span> Работа с Management API</a></li>
<li><a href="6-7-google-analytics.html#--core-reporting-api"><span class="toc-section-number">6.7.4</span> Работа с Core Reporting API</a></li>
<li><a href="6-7-google-analytics.html#--multi-channel-funnels-api"><span class="toc-section-number">6.7.5</span> Работа с Multi-Channel Funnels API</a></li>
<li><a href="6-7-google-analytics.html#--real-time-reporting-api"><span class="toc-section-number">6.7.6</span> Работа с Real time reporting API</a></li>
</ul></li>
<li class="has-sub"><a href="6-3-api-.html#---api--"><span class="toc-section-number">6.8</span> Загрузка данных из API Яндекс Метрики</a><ul>
<li><a href="6-3-api-.html#----api--"><span class="toc-section-number">6.8.1</span> Авторизация для работы с API Яндекс Метрики</a></li>
<li><a href="6-8-api-.html#----api---"><span class="toc-section-number">6.8.2</span> Функции для работы с API управления Яндекс Метрики</a></li>
<li><a href="6-8-api-.html#---api---"><span class="toc-section-number">6.8.3</span> Загрузка данных из API отчётов Яндекс Метрики</a></li>
<li><a href="6-8-api-.html#---logs-api--"><span class="toc-section-number">6.8.4</span> Загрузка данных из Logs API Яндекс Метрики</a></li>
<li><a href="6-8-api-.html#---api-----core-reporting-api-google-analytics"><span class="toc-section-number">6.8.5</span> Загрузка данных из API Яндекс Метрики совместимого с Core Reporting API Google Analytics</a></li>
</ul></li>
<li class="has-sub"><a href="6-9-google-search-console.html#--google-search-console"><span class="toc-section-number">6.9</span> Работа с Google Search Console</a><ul>
<li><a href="6-9-google-search-console.html#----5000---1-"><span class="toc-section-number">6.9.1</span> Как обойти ограничение в 5000 строк на 1 запрос</a></li>
</ul></li>
<li class="has-sub"><a href="6-10-google-trends.html#--google-trends"><span class="toc-section-number">6.10</span> Работа с Google Trends</a><ul>
<li><a href="6-10-google-trends.html#-----google-trends"><span class="toc-section-number">6.10.1</span> Манипуляция с данными полученными из Google Trends</a></li>
</ul></li>
<li class="has-sub"><a href="5-6-r.html#--"><span class="toc-section-number">6.11</span> Парсинг веб сайтов</a><ul>
<li><a href="5-6-r.html#----"><span class="toc-section-number">6.11.1</span> Поиск элементов на веб странице</a></li>
<li><a href="6-11-.html#-----html-"><span class="toc-section-number">6.11.2</span> Извлечение значений из полученныз элементов HTML страницы</a></li>
<li><a href="2-1-.html#---"><span class="toc-section-number">6.11.3</span> Имитация пользовательской веб сессии</a></li>
</ul></li>
<li><a href="6-1-api.html#-http-"><span class="toc-section-number">6.12</span> отправка HTTP запросов</a></li>
</ul></li>
<li class="has-sub"><a href="7-3-api-.html#-3-----api----."><span class="toc-section-number">7</span> Модуль 3: Работа с загруженными из API интерфейсов различных сервисов данными.</a><ul>
<li><a href="7-1-google-.html#-----google-"><span class="toc-section-number">7.1</span> Отправка и стение данных из Google Таблиц</a></li>
<li class="has-sub"><a href="7-2-ggplot2.html#-----ggplot2"><span class="toc-section-number">7.2</span> Визуализация данных с помощью пакета ggplot2</a><ul>
<li><a href="7-2-ggplot2.html#---qplot"><span class="toc-section-number">7.2.1</span> Быстрый график, функция <code>qplot</code></a></li>
<li><a href="2-1-.html#---"><span class="toc-section-number">7.2.2</span> Построение графиков наложением слоёв</a></li>
</ul></li>
<li class="has-sub"><a href="7-3-dbi-.html#----dbi-------"><span class="toc-section-number">7.3</span> Работа с базами данных, DBI - Интерфейс взаимодействия с базами данных</a><ul>
<li><a href="7-3-dbi-.html#---mysql"><span class="toc-section-number">7.3.1</span> Работа с СУБД MySQL</a></li>
<li><a href="7-3-dbi-.html#----postgresql"><span class="toc-section-number">7.3.2</span> Работа с базой данных PostgreSQL</a></li>
<li><a href="7-3-dbi-.html#----sqlite"><span class="toc-section-number">7.3.3</span> Работа с базой данных SQLite</a></li>
<li><a href="7-3-dbi-.html#-----google-bigquery"><span class="toc-section-number">7.3.4</span> Работа с облачной базой данных Google BigQuery</a></li>
</ul></li>
<li><a href="5-6-r.html#----r"><span class="toc-section-number">7.4</span> Отправка почты с помощью R</a></li>
<li class="has-sub"><a href="7-5-r-.html#---r---"><span class="toc-section-number">7.5</span> Как настроить запуск R скриптов по рассписанию</a><ul>
<li><a href="2-1-.html#---"><span class="toc-section-number">7.5.1</span> Настройка расписание через плагин</a></li>
<li><a href="7-5-r-.html#------taskscheduler"><span class="toc-section-number">7.5.2</span> Настройка расписание с помощью функций пакета taskscheduleR</a></li>
<li><a href="7-5-r-.html#------windows"><span class="toc-section-number">7.5.3</span> Ручная настройка рассписания через планировщик задач Windows</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="8-r-r-sources.html#-----r-r-sources"><span class="toc-section-number">8</span> Полезные, русскоязычные ресурсы по языку R (r sources)</a><ul>
<li><a href="2-1-.html#---"><span class="toc-section-number">8.1</span> Группы в социальных сетях</a></li>
<li><a href="2-1-.html#---"><span class="toc-section-number">8.2</span> Телеграмм каналы и чаты</a></li>
<li><a href="8-3-section-8-3.html#section-8.3"><span class="toc-section-number">8.3</span> Блоги</a></li>
</ul></li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="-----ggplot2" class="section level2">
<h2><span class="header-section-number">7.2</span> Визуализация данных с помощью пакета ggplot2</h2>
<p>Пакет <code>ggplot2</code> на данный момент является один из самых популярнов R пакетов, на данный момент он был установлен более 1 млн. раз. Для установки пакета выполните команду <code>install.packages(&quot;ggplot2&quot;)</code>.</p>
<div id="---qplot" class="section level3">
<h3><span class="header-section-number">7.2.1</span> Быстрый график, функция <code>qplot</code></h3>
<p>Функция <code>qplot</code> позволяет вам максимально быстро строить несложные, и при этом достаточно красивые графики.</p>
<p><strong>Аргументы функции qplot</strong></p>
<ul>
<li>x - Ось X</li>
<li>y - Ось Y</li>
<li>data - Дата фрейм в котором хранятся данные для визуализации</li>
<li>facets - Формула, которая разобъёт график на подграфики</li>
<li>geom - Геометрия, тип графика, так же можно указать вектор и отразить на одном графике несколько геометрий например <code>geom = c(&quot;line&quot;, &quot;point&quot;)</code> позволит вам на одном графике совместить линейный и точечный график</li>
<li>xlim, ylim - Лимиты по хначем осей x и y</li>
<li>main - Заголовок графика</li>
<li>xlab, ylab - Подписи осей</li>
</ul>
<p>Для начала давайте загрузим данные, которое потом и будем визуализировать.</p>
<p><strong>Пример работы с функцией qplot</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(RGA)</code></pre></div>
<pre><code>## Please use predefined Credentials only for the testing requests. To obtain your own Credentials see help(authorize).</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># load data from Google Analytics</span>
ga_data &lt;-<span class="st"> </span>RGA<span class="op">::</span><span class="kw">get_ga</span>(<span class="dt">profileId     =</span> <span class="st">&quot;ga:170507937&quot;</span>,
                       <span class="dt">start.date    =</span> <span class="st">&quot;14daysAgo&quot;</span>,
                       <span class="dt">end.date      =</span> <span class="st">&quot;yesterday&quot;</span>,
                       <span class="dt">metrics       =</span> <span class="st">&quot;ga:users,ga:sessions,ga:bounces&quot;</span>,
                       <span class="dt">dimensions    =</span> <span class="st">&quot;ga:date,ga:source,ga:medium&quot;</span>,
                       <span class="dt">samplingLevel =</span> <span class="st">&quot;HIGHER_PRECISION&quot;</span>,
                       <span class="dt">token         =</span> <span class="kw">readRDS</span>(<span class="st">&quot;.r.for.marketing@gmail.com-token.rds&quot;</span>)[[<span class="dv">1</span>]])</code></pre></div>
<p><strong>Пример работы с функцией qplot</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)

<span class="co"># first plot</span>
<span class="co"># prepare data</span>
<span class="co"># sessions by date</span>
ga_data <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(date) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">sessions =</span> <span class="kw">sum</span>(sessions)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">qplot</span>(<span class="dt">data =</span> .,
        <span class="dt">x    =</span> date,
        <span class="dt">y    =</span> sessions,
        <span class="dt">geom =</span> <span class="kw">c</span>(<span class="st">&quot;line&quot;</span>, <span class="st">&quot;point&quot;</span>),
        <span class="dt">main =</span> <span class="st">&quot;Sessions by date&quot;</span>)</code></pre></div>
<p><img src="r_for_marketing_files/figure-html/unnamed-chunk-104-1.png" width="672"  /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># with group</span>
ga_data <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(date, medium) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">sessions =</span> <span class="kw">sum</span>(sessions)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">qplot</span>(<span class="dt">data  =</span> .,
        <span class="dt">x     =</span> date,
        <span class="dt">y     =</span> sessions,
        <span class="dt">group =</span> medium,
        <span class="dt">geom  =</span> <span class="kw">c</span>(<span class="st">&quot;line&quot;</span>, <span class="st">&quot;point&quot;</span>),
        <span class="dt">main  =</span> <span class="st">&quot;Sessions by date and medium&quot;</span>,
        <span class="dt">color =</span> medium)</code></pre></div>
<p><img src="r_for_marketing_files/figure-html/unnamed-chunk-104-2.png" width="672"  /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># with facets</span>
ga_data <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(date, medium) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">sessions    =</span> <span class="kw">sum</span>(sessions),
            <span class="dt">bounce_rate =</span> <span class="kw">sum</span>(bounces) <span class="op">/</span><span class="st"> </span>sessions) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">qplot</span>(<span class="dt">data   =</span> .,
        <span class="dt">x      =</span> date,
        <span class="dt">y      =</span> sessions,
        <span class="dt">group  =</span> medium,
        <span class="dt">geom   =</span> <span class="kw">c</span>(<span class="st">&quot;line&quot;</span>, <span class="st">&quot;point&quot;</span>),
        <span class="dt">main   =</span> <span class="st">&quot;Sessions by date and medium&quot;</span>,
        <span class="dt">color  =</span> bounce_rate,
        <span class="dt">facets =</span> medium <span class="op">~</span><span class="st"> </span>.)</code></pre></div>
<p><img src="r_for_marketing_files/figure-html/unnamed-chunk-104-3.png" width="672"  /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># daily sessions from different medium</span>
ga_data <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">qplot</span>(<span class="dt">data =</span> .,
        <span class="dt">x    =</span> medium,
        <span class="dt">y    =</span> sessions,
        <span class="dt">geom =</span> <span class="kw">c</span>(<span class="st">&quot;boxplot&quot;</span>),
        <span class="dt">fill =</span> medium,
        <span class="dt">main =</span> <span class="st">&quot;Daily sessions by medium&quot;</span>)</code></pre></div>
<p><img src="r_for_marketing_files/figure-html/unnamed-chunk-104-4.png" width="672"  /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># bounce rate by medium</span>
ga_data <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(medium) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">bounce_rate =</span> <span class="kw">sum</span>(bounces) <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(sessions)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">qplot</span>(<span class="dt">data =</span> .,
        <span class="dt">x    =</span> medium,
        <span class="dt">y    =</span> bounce_rate,
        <span class="dt">geom =</span> <span class="st">&quot;col&quot;</span>,
        <span class="dt">fill =</span> bounce_rate,
        <span class="dt">main =</span> <span class="st">&quot;Bounce rate by medium&quot;</span>)</code></pre></div>
<p><img src="r_for_marketing_files/figure-html/unnamed-chunk-104-5.png" width="672"  /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># users by date and medium</span>
ga_data <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(date, medium) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">users =</span> <span class="kw">sum</span>(users)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">qplot</span>(<span class="dt">data  =</span> .,
        <span class="dt">x     =</span> date,
        <span class="dt">y     =</span> users,
        <span class="dt">group =</span> date,
        <span class="dt">geom  =</span> <span class="st">&quot;col&quot;</span>,
        <span class="dt">fill  =</span> medium,
        <span class="dt">main =</span> <span class="st">&quot;Users by date and medium&quot;</span>)</code></pre></div>
<p><img src="r_for_marketing_files/figure-html/unnamed-chunk-104-6.png" width="672"  /></p>
</div>
<div id="---" class="section level3">
<h3><span class="header-section-number">7.2.2</span> Построение графиков наложением слоёв</h3>
<p>Рассмотренная нами функция <code>qplot</code> позволяет вам быстро создать несложный график, но в целом синтаксис пакета ggplot2 позволяет строить и значительно более сложные графики, реализуется такой подход с помощью большого набора функций, каждая функция и является отдельным слоем, к которому вы можете задавать свои настройки, все слои объединяются в один график с помозью знака <code>+</code>.</p>
<p>Первый, основной слой задётся с помощью функции <code>ggplot</code>. Далее мы можем накладывать другие слои с помощью функций семейств:</p>
<ul>
<li>geom - геометрии, типы графиков</li>
<li>aes - Функция для задания эстетических настроек слоя</li>
<li>scale - шкалы осей x и y</li>
<li>theme - изменение внешнего вида любого элемента графика</li>
<li>facet - разбивка графика а подграфики</li>
</ul>
<p><strong>Пример построения графиков наложением слоёв</strong></p>
<p>В этот раз мы будем визуализировать данные полученные из Logs API Яндекс Метрики.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(getProxy)
<span class="kw">library</span>(rym)
<span class="co"># обход блокировки</span>
<span class="kw">getProxy</span>(<span class="dt">port =</span> <span class="st">&quot;3128&quot;</span>,
         <span class="dt">country =</span> <span class="st">&quot;RU&quot;</span>,
         <span class="dt">supportsHttps =</span> <span class="ot">TRUE</span>,
         <span class="dt">action =</span> <span class="st">&quot;start&quot;</span>)

<span class="co"># loading data</span>
ym_data &lt;-<span class="st"> </span><span class="kw">rym_get_logs</span>(<span class="dt">counter   =</span> <span class="st">&quot;10595804&quot;</span>,
                        <span class="dt">date.from =</span> <span class="st">&quot;2018-08-25&quot;</span>,
                        <span class="dt">date.to   =</span> <span class="st">&quot;2018-09-01&quot;</span>,
                        <span class="dt">fields    =</span> <span class="st">&quot;ym:s:date,</span>
<span class="st">                                     ym:s:pageViews,</span>
<span class="st">                                     ym:s:visitDuration,</span>
<span class="st">                                     ym:s:regionCity,</span>
<span class="st">                                     ym:s:lastTrafficSource,</span>
<span class="st">                                     ym:s:deviceCategory&quot;</span>,
                        <span class="dt">source    =</span> <span class="st">&quot;visits&quot;</span>,
                        <span class="dt">login      =</span> <span class="st">&quot;vipman.netpeak&quot;</span>)
                        
<span class="co"># Отключаемся от прокси</span>
<span class="kw">getProxy</span>(<span class="dt">action =</span> <span class="st">&quot;stop&quot;</span>)</code></pre></div>
<p>Далее мы разберём большое количество примеров работы со слоями</p>
<ol style="list-style-type: decimal">
<li>Простая визуализация, построение график ящик с усами</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># vizualize</span>
<span class="co"># step_1 - basic</span>
<span class="kw">ggplot</span>(<span class="dt">data =</span> ym_data, <span class="kw">aes</span>(<span class="dt">x =</span> ym.s.lastTrafficSource, <span class="dt">y =</span> ym.s.pageViews)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_boxplot</span>()</code></pre></div>
<p><img src="r_for_marketing_files/figure-html/unnamed-chunk-105-1.png" width="672"  /></p>
<ol start="2" style="list-style-type: decimal">
<li>Изменяем лимиты по оси y, таким образом убирая выбросы В первом случае мы задаём лимиты с помощью слоя <code>coord_cartesian</code>, который принимает ектор из двух числовых значений, это минимальное и максимальное допустимое значение, функциия <code>coord_cartesian</code> работает как увеличительное стеклопросто увеличивает указанную вами часть графика, при этом из таблицы данных никакая информация не удаляется.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># step_2 - remove outliers</span>
<span class="co"># zoom</span>
<span class="kw">ggplot</span>(<span class="dt">data =</span> ym_data, <span class="kw">aes</span>(<span class="dt">x =</span> ym.s.lastTrafficSource, <span class="dt">y =</span> ym.s.pageViews)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_boxplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">20</span>))</code></pre></div>
<p><img src="r_for_marketing_files/figure-html/unnamed-chunk-106-1.png" width="672"  /></p>
<p>Теперь мы ограничим значение по оси y с помощью функции <code>ylim</code>, данная функция удаляет из таблицы данных все строки которые выходят за пределы указанных минимального и максимального значения, что повлечёт за собой изменение среднего значения и медианы, и в целом всех квартилей.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># remove</span>
<span class="kw">ggplot</span>(<span class="dt">data =</span> ym_data, <span class="kw">aes</span>(<span class="dt">x =</span> ym.s.lastTrafficSource, <span class="dt">y =</span> ym.s.pageViews)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="dt">fill =</span> <span class="st">&quot;blue&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">ylim</span>(<span class="dv">0</span>, <span class="dv">20</span>)</code></pre></div>
<pre><code>## Warning: Removed 5898 rows containing non-finite values (stat_boxplot).</code></pre>
<p><img src="r_for_marketing_files/figure-html/unnamed-chunk-107-1.png" width="672"  /></p>
<ol start="3" style="list-style-type: decimal">
<li>Теперь попрбуем изменить цвет ящиков в зависимости от медианного значения количества просмотров, и с помощь функции <code>scale_fill_gradient</code> укажем тчо мы хотим градиентный переход в зависимости от этого значения.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># step_3 - color</span>
<span class="kw">group_by</span>(ym_data, ym.s.lastTrafficSource) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">m_pageviews =</span> <span class="kw">median</span>(ym.s.pageViews)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="dt">data =</span> ., <span class="kw">aes</span>(<span class="dt">x =</span> ym.s.lastTrafficSource, <span class="dt">y =</span> ym.s.pageViews)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_boxplot</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> m_pageviews)) <span class="op">+</span>
<span class="st">    </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">20</span>)) <span class="op">+</span>
<span class="st">    </span><span class="kw">scale_fill_gradient</span>(<span class="dt">low =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">high =</span> <span class="st">&quot;green&quot;</span>)</code></pre></div>
<p><img src="r_for_marketing_files/figure-html/unnamed-chunk-108-1.png" width="672"  /></p>
<ol start="4" style="list-style-type: decimal">
<li>Следующий шаг - отсортировать переменные оси x в порядке убывания, таким образом что бы первый, самый левый ящие соответсовал каналу с самым высоким медианным значением количества просмотра страниц на сеанс, а самымй правый наоборот соответсвовал каналу в котором наименьшее медианное значение количества просмотра страниц на сеанс, делается это с помощью пересортировки уровней фактора через функции <code>with</code> и <code>reorder</code>.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># step_4 - reorder</span>
ym_data<span class="op">$</span>ym.s.lastTrafficSource &lt;-<span class="st"> </span><span class="kw">with</span>(ym_data, <span class="kw">reorder</span>(ym.s.lastTrafficSource, ym.s.pageViews, <span class="cf">function</span>(x) <span class="op">-</span><span class="kw">median</span>(x)))

<span class="kw">group_by</span>(ym_data, ym.s.lastTrafficSource) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">m_pageviews =</span> <span class="kw">median</span>(ym.s.pageViews)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="dt">data =</span> ., <span class="kw">aes</span>(<span class="dt">x =</span> ym.s.lastTrafficSource, <span class="dt">y =</span> ym.s.pageViews)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> m_pageviews)) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">20</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_gradient</span>(<span class="dt">low =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">high =</span> <span class="st">&quot;green&quot;</span>)</code></pre></div>
<p><img src="r_for_marketing_files/figure-html/unnamed-chunk-109-1.png" width="672"  /></p>
<ol start="5" style="list-style-type: decimal">
<li>Разбиваем полученные графики на подграфики с помощью функции <code>facet_grid</code>.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># step_5 - facet</span>
ym_data<span class="op">$</span>device &lt;-<span class="st"> </span><span class="kw">vapply</span>(ym_data<span class="op">$</span>ym.s.deviceCategory,
                         <span class="dt">FUN =</span> <span class="cf">function</span>(x) <span class="cf">switch</span>(x,
                                                  <span class="st">&quot;1&quot;</span> =<span class="st"> &quot;десктоп&quot;</span>,
                                                  <span class="st">&quot;2&quot;</span> =<span class="st"> &quot;мобильные телефоны&quot;</span>,
                                                  <span class="st">&quot;3&quot;</span> =<span class="st"> &quot;планшеты&quot;</span>,
                                                  <span class="st">&quot;4&quot;</span> =<span class="st"> &quot;TV&quot;</span>),
                         <span class="dt">FUN.VALUE =</span> <span class="st">&quot;character&quot;</span>)

<span class="kw">group_by</span>(ym_data, ym.s.lastTrafficSource, device) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">m_pageviews =</span> <span class="kw">median</span>(ym.s.pageViews)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="dt">data =</span> ., <span class="kw">aes</span>(<span class="dt">x =</span> ym.s.lastTrafficSource, <span class="dt">y =</span> ym.s.pageViews)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> m_pageviews)) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">20</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_gradient</span>(<span class="dt">low =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">high =</span> <span class="st">&quot;green&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_grid</span>(device <span class="op">~</span><span class="st"> </span>.)</code></pre></div>
<p><img src="r_for_marketing_files/figure-html/unnamed-chunk-110-1.png" width="672"  /></p>
<ol start="6" style="list-style-type: decimal">
<li>С помощью функции <code>theme</code> изменим ориентацию подписей оси x с горихонтальной на вертикальную, и немного увеличим шрифт.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># step_6 - themes</span>
<span class="kw">group_by</span>(ym_data, ym.s.lastTrafficSource, device) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">m_pageviews =</span> <span class="kw">median</span>(ym.s.pageViews)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="dt">data =</span> ., <span class="kw">aes</span>(<span class="dt">x =</span> ym.s.lastTrafficSource, <span class="dt">y =</span> ym.s.pageViews)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> m_pageviews)) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">20</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_gradient</span>(<span class="dt">low =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">high =</span> <span class="st">&quot;green&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_grid</span>(device <span class="op">~</span><span class="st"> </span>.) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">90</span>, <span class="dt">hjust =</span> <span class="dv">1</span>, <span class="dt">vjust =</span> <span class="fl">0.5</span>, <span class="dt">size =</span> <span class="dv">12</span>))</code></pre></div>
<p><img src="r_for_marketing_files/figure-html/unnamed-chunk-111-1.png" width="672"  /></p>
<ol start="7" style="list-style-type: decimal">
<li>Так же мы можем менять общую тему всего графика применяю уже готовые темы с помощью семейства функций <code>theme</code>.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">group_by</span>(ym_data, ym.s.lastTrafficSource, device) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">m_pageviews =</span> <span class="kw">median</span>(ym.s.pageViews)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="dt">data =</span> ., <span class="kw">aes</span>(<span class="dt">x =</span> ym.s.lastTrafficSource, <span class="dt">y =</span> ym.s.pageViews)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> m_pageviews)) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">20</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_gradient</span>(<span class="dt">low =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">high =</span> <span class="st">&quot;green&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_grid</span>(device <span class="op">~</span><span class="st"> </span>.) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">90</span>, <span class="dt">hjust =</span> <span class="dv">1</span>, <span class="dt">vjust =</span> <span class="fl">0.5</span>, <span class="dt">size =</span> <span class="dv">12</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_classic</span>()</code></pre></div>
<p><img src="r_for_marketing_files/figure-html/unnamed-chunk-112-1.png" width="672"  /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">group_by</span>(ym_data, ym.s.lastTrafficSource, device) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">m_pageviews =</span> <span class="kw">median</span>(ym.s.pageViews)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="dt">data =</span> ., <span class="kw">aes</span>(<span class="dt">x =</span> ym.s.lastTrafficSource, <span class="dt">y =</span> ym.s.pageViews)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> m_pageviews)) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">20</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_gradient</span>(<span class="dt">low =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">high =</span> <span class="st">&quot;green&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_grid</span>(device <span class="op">~</span><span class="st"> </span>.) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">90</span>, <span class="dt">hjust =</span> <span class="dv">1</span>, <span class="dt">vjust =</span> <span class="fl">0.5</span>, <span class="dt">size =</span> <span class="dv">12</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_dark</span>()</code></pre></div>
<p><img src="r_for_marketing_files/figure-html/unnamed-chunk-112-2.png" width="672"  /></p>
<ol start="8" style="list-style-type: decimal">
<li>Пример использования наложения разу 3ёх слоёв и изменения некоторых настроек каждого слоя в отдеьности.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># more layers</span>
<span class="kw">group_by</span>(ym_data, ym.s.date) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">page_pr_sessions =</span> <span class="kw">sum</span>(ym.s.pageViews) <span class="op">/</span><span class="st"> </span><span class="kw">n</span>()) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="dt">data =</span> ., <span class="kw">aes</span>(<span class="dt">x =</span> ym.s.date, <span class="dt">y =</span> page_pr_sessions, <span class="dt">group =</span> <span class="dv">1</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">color =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">size =</span> <span class="dv">3</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>()</code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="r_for_marketing_files/figure-html/unnamed-chunk-113-1.png" width="672"  /></p>
</div>
</div>
<p style="text-align: center;">
<a href="7-1-google-.html"><button class="btn btn-default">Previous</button></a>
<a href="7-3-dbi-.html"><button class="btn btn-default">Next</button></a>
</p>
</div>
</div>



</body>
</html>
